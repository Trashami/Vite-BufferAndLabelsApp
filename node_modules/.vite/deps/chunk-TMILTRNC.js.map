{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/hud/HUDUniforms.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nvar c;!function(c){c[c.Occluded=0]=\"Occluded\",c[c.NotOccluded=1]=\"NotOccluded\",c[c.Both=2]=\"Both\",c[c.COUNT=3]=\"COUNT\"}(c||(c={}));export{c as HUDTransparentRenderStyle};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{addVerticalOffset as e}from\"../attributes/VerticalOffset.glsl.js\";import{HUDTransparentRenderStyle as t}from\"./HUDUniforms.js\";import{ScreenSizePerspective as o,addScreenSizePerspectiveAlignment as a}from\"../util/ScreenSizePerspective.glsl.js\";import{addProjViewLocalOrigin as i,addCameraPosition as r,addViewNormal as s}from\"../util/View.glsl.js\";import{Float4PassUniform as n}from\"../../shaderModules/Float4PassUniform.js\";import{FloatPassUniform as l}from\"../../shaderModules/FloatPassUniform.js\";import{glsl as c}from\"../../shaderModules/interfaces.js\";import{Texture2DPassUniform as f}from\"../../shaderModules/Texture2DPassUniform.js\";import{VertexAttribute as d}from\"../../../lib/VertexAttribute.js\";var p;function u(u,v){u.include(o),u.attributes.add(d.POSITION,\"vec3\"),u.attributes.add(d.NORMAL,\"vec3\"),u.attributes.add(d.AUXPOS1,\"vec4\");const m=u.vertex;i(m,v),r(m,v),m.uniforms.add([new n(\"viewport\",((e,t)=>t.camera.fullViewport)),new l(\"polygonOffset\",(e=>e.shaderPolygonOffset)),new l(\"cameraGroundRelative\",((e,t)=>t.camera.aboveGround?1:-1)),new l(\"renderTransparentlyOccludedHUD\",((e,o)=>o.renderTransparentlyOccludedHUD===t.Occluded?1:o.renderTransparentlyOccludedHUD===t.NotOccluded?0:.75)),new f(\"hudVisibilityTexture\",((e,t)=>t.hudVisibilityTexture))]),v.hasVerticalOffset&&e(m),m.constants.add(\"smallOffsetAngle\",\"float\",.984807753012208),m.code.add(c`struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};`),m.code.add(c`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\nfloat pointGroundSign = sign(pointGroundDistance);\nif (pointGroundSign == 0.0) {\npointGroundSign = cameraGroundRelative;\n}\nfloat groundRelative = cameraGroundRelative * pointGroundSign;\nif (polygonOffset > .0) {\nfloat cosAlpha = clamp(absCosAngle, 0.01, 1.0);\nfloat tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\nfloat factor = (1.0 - tanAlpha / viewport[2]);\nif (groundRelative > 0.0) {\nposView *= factor;\n}\nelse {\nposView /= factor;\n}\n}\nreturn groundRelative;\n}`),v.isDraped&&!v.hasVerticalOffset||s(m),v.isDraped||(m.uniforms.add(new l(\"perDistancePixelRatio\",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),m.code.add(c`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\nfloat distanceToCamera = length(posView);\nfloat pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\nvec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\nvec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\nposModel += modelOffset;\nposView += viewOffset;\n}`)),v.screenCenterOffsetUnitsEnabled===p.Screen&&m.uniforms.add(new l(\"pixelRatio\",((e,t)=>t.camera.pixelRatio))),v.hasScreenSizePerspective&&a(m),m.code.add(c`\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ${v.isDraped?\"\":\"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\"}\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ${v.hasScreenSizePerspective&&(v.hasVerticalOffset||v.screenCenterOffsetUnitsEnabled===p.Screen)?\"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\":\"\"}\n\n      ${v.hasVerticalOffset?v.hasScreenSizePerspective?\"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\":\"float verticalOffsetScreenHeight = verticalOffset.x;\":\"\"}\n\n      ${v.hasVerticalOffset?c`\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;`:\"\"}\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ${v.screenCenterOffsetUnitsEnabled!==p.Screen?c`\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          `:\"\"}\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ${v.screenCenterOffsetUnitsEnabled===p.Screen?v.hasScreenSizePerspective?\"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\":\"float centerOffsetY = centerOffset.y;\":\"\"}\n\n      ${v.screenCenterOffsetUnitsEnabled===p.Screen?\"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\":\"\"}\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  `),m.code.add(c`bool testVisibilityHUD(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (renderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}`)}!function(e){e[e.World=0]=\"World\",e[e.Screen=1]=\"Screen\",e[e.COUNT=2]=\"COUNT\"}(p||(p={}));export{u as HUD,p as HUDSpace};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{glsl as e}from\"../../shaderModules/interfaces.js\";function c(c){const i=e`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}`,o=e`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}`;c.vertex.code.add(i),c.vertex.code.add(o),c.fragment.code.add(i),c.fragment.code.add(o)}export{c as AlignPixel};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{ReadLinearDepth as e}from\"../output/ReadLinearDepth.glsl.js\";import{Float2PassUniform as r}from\"../../shaderModules/Float2PassUniform.js\";import{glsl as t}from\"../../shaderModules/interfaces.js\";import{Texture2DPassUniform as o}from\"../../shaderModules/Texture2DPassUniform.js\";function a(a){a.include(e),a.uniforms.add([new o(\"geometryDepthTexture\",((e,r)=>r.multipassGeometry.linearDepthTexture)),new r(\"nearFar\",((e,r)=>r.camera.nearFar))]),a.code.add(t`bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}`)}class s{constructor(){this.enabled=!1}}export{s as MultipassGeometryUniforms,a as multipassGeometryTest};\n"],
  "mappings": "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",
  "names": ["c", "u", "v", "c", "e", "o", "f", "c", "i", "o", "a", "e"]
}
