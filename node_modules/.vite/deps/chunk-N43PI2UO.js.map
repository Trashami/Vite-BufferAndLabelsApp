{
  "version": 3,
  "sources": ["../../@arcgis/core/core/MemCache.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"./maybe.js\";import e from\"./PooledArray.js\";const s=-3;var i;!function(t){t[t.ALL=0]=\"ALL\",t[t.SOME=1]=\"SOME\"}(i||(i={}));class r{constructor(t,e,s){this._namespace=t,this._storage=e,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=\":\",s&&(this._storage.registerRemoveFunc(this._namespace,s),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,e,s,i=0){this._storage.put(this._namespace+t,e,s,i)}get(t){const e=this._storage.get(this._namespace+t);return void 0===e?++this._miss:++this._hit,e}pop(t){const e=this._storage.pop(this._namespace+t);return void 0===e?++this._miss:++this._hit,e}updateSize(t,e,s){this._storage.updateSize(this._namespace+t,e,s)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class h{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new e,this._users=new e}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,e){this._removeFuncs.push([t,e])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace((e=>e[0]!==t))}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,e,r,h){const _=this._db.get(t);if(_&&(this._size-=_.size,this._db.delete(t),_.entry!==e&&this._notifyRemove(t,_.entry,i.ALL)),r>this._maxSize)return void this._notifyRemove(t,e,i.ALL);if(void 0===e)return void console.warn(\"Refusing to cache undefined entry \");if(!r||r<0)return void console.warn(\"Refusing to cache entry with invalid size \"+r);const o=1+Math.max(h,s)-s;this._db.set(t,{entry:e,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(e,s,r){const h=this._db.get(e);if(h&&h.entry===s){for(this._size-=h.size;r>this._maxSize;){const h=this._notifyRemove(e,s,i.SOME);if(!(t(h)&&h>0))return void this._db.delete(e);r=h}h.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const e=this._db.get(t);if(e)return this._size-=e.size,this._db.delete(t),++this._hit,e.entry;++this._miss}get(t){const e=this._db.get(t);if(void 0!==e)return this._db.delete(t),e.lives=e.lifetime,this._db.set(t,e),++this._hit,e.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+\"/\"+Math.round(this._maxSize/1048576)+\"MB\",\"Hit rate\":Math.round(100*this._getHitRate())+\"%\",Entries:this._db.size.toString()},e={},i=new Array;this._db.forEach(((t,s)=>{const r=t.lifetime;i[r]=(i[r]||0)+t.size,this._users.forAll((i=>{const r=i.namespace;if(s.startsWith(r)){const s=e[r]||0;e[r]=s+t.size}}))}));const r={};this._users.forAll((t=>{const s=t.namespace;if(!isNaN(t.hitRate)&&t.hitRate>0){const i=e[s]||0;e[s]=i,r[s]=Math.round(100*t.hitRate)+\"%\"}else r[s]=\"0%\"}));const h=Object.keys(e);h.sort(((t,s)=>e[s]-e[t])),h.forEach((s=>t[s]=Math.round(e[s]/2**20)+\"MB / \"+r[s]));for(let _=i.length-1;_>=0;--_){const e=i[_];e&&(t[\"Priority \"+(_+s-1)]=Math.round(e/this.size*100)+\"%\")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll((t=>t.resetHitRate()))}clear(t){this._db.forEach(((e,s)=>{s.startsWith(t)&&(this._size-=e.size,this._db.delete(s),this._notifyRemove(s,e.entry,i.ALL))}))}clearAll(){this._db.forEach(((t,e)=>this._notifyRemove(e,t.entry,i.ALL))),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,e,s){let i;return this._removeFuncs.some((r=>{if(t.startsWith(r[0])){const t=r[1](e,s);return\"number\"==typeof t&&(i=t),!0}return!1})),i}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,s]of this._db){if(this._db.delete(e),s.lives<=1){this._size-=s.size;const r=this._notifyRemove(e,s.entry,i.SOME);t(r)&&r>0&&(this._size+=r,s.lives=s.lifetime,s.size=r,this._db.set(e,s))}else--s.lives,this._db.set(e,s);if(this._size<=.9*this.maxSize)return}}}export{s as MIN_PRIORITY,r as MemCache,h as MemCacheStorage,i as RemoveMode};\n"],
  "mappings": "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",
  "names": ["r", "s", "i", "h", "t", "e"]
}
