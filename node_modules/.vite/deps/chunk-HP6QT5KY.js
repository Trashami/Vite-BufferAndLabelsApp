import {
  E as E3,
  u as u2
} from "./chunk-HNRPDSCT.js";
import {
  t as t3
} from "./chunk-XTFH7327.js";
import {
  W,
  _
} from "./chunk-MOPTUDCV.js";
import {
  n as n3,
  x
} from "./chunk-O4DPVR3F.js";
import {
  E as E2,
  a as a4
} from "./chunk-MATM5L52.js";
import {
  u as u3
} from "./chunk-YJIITZRY.js";
import {
  x as x2
} from "./chunk-MIXBH4EM.js";
import {
  a as a3,
  t as t4
} from "./chunk-ZLTZ3KAT.js";
import {
  D,
  E,
  G,
  L,
  M,
  P,
  V,
  Y
} from "./chunk-3OFVLRSL.js";
import {
  r as r4
} from "./chunk-75RMBUYZ.js";
import {
  n as n2
} from "./chunk-ZEEU5HOK.js";
import {
  a as a2,
  h
} from "./chunk-C5H57NTD.js";
import {
  A,
  g,
  j,
  o as o2,
  r as r3,
  u
} from "./chunk-3LR5O4WA.js";
import {
  n,
  r as r2,
  t as t2
} from "./chunk-D4V6J5BT.js";
import {
  l
} from "./chunk-OOLCFNXJ.js";
import {
  a,
  o,
  r,
  t
} from "./chunk-MIHB3CIK.js";

// node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule.js
var t5 = class {
  constructor(t7, o5) {
    this._module = t7, this._loadModule = o5;
  }
  get() {
    return this._module;
  }
  async reload() {
    return this._module = await this._loadModule(), this._module;
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique.js
var e = class {
  constructor(i2, t7, e3) {
    this.release = e3, this.initializeConfiguration(i2, t7), this._configuration = t7.snapshot(), this._program = this.initializeProgram(i2), this._pipeline = this.initializePipeline(i2.rctx.capabilities);
  }
  destroy() {
    this._program = a(this._program), this._pipeline = this._configuration = null;
  }
  reload(t7) {
    a(this._program), this._program = this.initializeProgram(t7), this._pipeline = this.initializePipeline(t7.rctx.capabilities);
  }
  get program() {
    return this._program;
  }
  get compiled() {
    return this.program.isCompiled;
  }
  get key() {
    return this._configuration.key;
  }
  get configuration() {
    return this._configuration;
  }
  bindPipelineState(i2, t7 = null, e3) {
    i2.setPipelineState(this.getPipelineState(t7, e3));
  }
  ensureAttributeLocations(i2) {
    this.program.assertCompatibleVertexAttributeLocations(i2);
  }
  get primitiveType() {
    return E.TRIANGLES;
  }
  getPipelineState(i2, t7) {
    return this._pipeline;
  }
  initializeConfiguration(i2, t7) {
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/Program.js
var o3 = class {
  constructor(t7, e3, o5) {
    this._context = t7, this._locations = o5, this._textures = /* @__PURE__ */ new Map(), this._freeTextureUnits = new l({ deallocator: null }), this._glProgram = t7.programCache.acquire(e3.generate("vertex"), e3.generate("fragment"), o5), this._glProgram.stop = () => {
      throw new Error("Wrapped _glProgram used directly");
    }, this.bindPass = e3.generateBind(a3.Pass, this), this.bindDraw = e3.generateBind(a3.Draw, this), this._fragmentUniforms = a4() ? e3.fragmentUniforms : null;
  }
  dispose() {
    this._glProgram.dispose();
  }
  get glName() {
    return this._glProgram.glName;
  }
  get isCompiled() {
    return this._glProgram.isCompiled;
  }
  setUniform1b(t7, e3) {
    this._glProgram.setUniform1i(t7, e3 ? 1 : 0);
  }
  setUniform1i(t7, e3) {
    this._glProgram.setUniform1i(t7, e3);
  }
  setUniform1f(t7, e3) {
    this._glProgram.setUniform1f(t7, e3);
  }
  setUniform2fv(t7, e3) {
    this._glProgram.setUniform2fv(t7, e3);
  }
  setUniform3fv(t7, e3) {
    this._glProgram.setUniform3fv(t7, e3);
  }
  setUniform4fv(t7, e3) {
    this._glProgram.setUniform4fv(t7, e3);
  }
  setUniformMatrix3fv(t7, e3) {
    this._glProgram.setUniformMatrix3fv(t7, e3);
  }
  setUniformMatrix4fv(t7, e3) {
    this._glProgram.setUniformMatrix4fv(t7, e3);
  }
  setUniform1fv(t7, e3) {
    this._glProgram.setUniform1fv(t7, e3);
  }
  setUniform1iv(t7, e3) {
    this._glProgram.setUniform1iv(t7, e3);
  }
  setUniform2iv(t7, e3) {
    this._glProgram.setUniform3iv(t7, e3);
  }
  setUniform3iv(t7, e3) {
    this._glProgram.setUniform3iv(t7, e3);
  }
  setUniform4iv(t7, e3) {
    this._glProgram.setUniform4iv(t7, e3);
  }
  assertCompatibleVertexAttributeLocations(t7) {
    t7.locations !== this._locations && console.error("VertexAttributeLocations are incompatible");
  }
  stop() {
    this._textures.clear(), this._freeTextureUnits.clear();
  }
  bindTexture(e3, r7) {
    if (t(r7) || null == r7.glName) {
      const t7 = this._textures.get(e3);
      return t7 && (this._context.bindTexture(null, t7.unit), this._freeTextureUnit(t7), this._textures.delete(e3)), null;
    }
    let i2 = this._textures.get(e3);
    return null == i2 ? (i2 = this._allocTextureUnit(r7), this._textures.set(e3, i2)) : i2.texture = r7, this._context.useProgram(this), this.setUniform1i(e3, i2.unit), this._context.bindTexture(r7, i2.unit), i2.unit;
  }
  rebindTextures() {
    this._context.useProgram(this), this._textures.forEach((t7, e3) => {
      this._context.bindTexture(t7.texture, t7.unit), this.setUniform1i(e3, t7.unit);
    }), r(this._fragmentUniforms) && this._fragmentUniforms.forEach((t7) => {
      "sampler2D" !== t7.type && "samplerCube" !== t7.type || this._textures.has(t7.name) || console.error(`Texture sampler ${t7.name} has no bound texture`);
    });
  }
  _allocTextureUnit(t7) {
    return { texture: t7, unit: 0 === this._freeTextureUnits.length ? this._textures.size : this._freeTextureUnits.pop() };
  }
  _freeTextureUnit(t7) {
    this._freeTextureUnits.push(t7.unit);
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/SSAOBlurTechnique.js
var l2 = class extends e {
  initializeProgram(r7) {
    return new o3(r7.rctx, l2.shader.get().build(), E3);
  }
  initializePipeline() {
    return W({ colorWrite: _ });
  }
};
l2.shader = new t5(u3, () => import("./SSAOBlur.glsl-KA3DNBWN.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/SSAOTechnique.js
var l3 = class extends e {
  initializeProgram(e3) {
    return new o3(e3.rctx, l3.shader.get().build(), E3);
  }
  initializePipeline() {
    return W({ colorWrite: _ });
  }
};
l3.shader = new t5(x2, () => import("./SSAO.glsl-KCHIHYAR.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/SSAOParameters.js
var r5 = class extends t4 {
  constructor() {
    super(...arguments), this.projScale = 1;
  }
};
var t6 = class extends r5 {
};
var c = class extends t4 {
};
var o4 = class extends c {
  constructor() {
    super(...arguments), this.blurSize = n2();
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/SSAOHelper.js
var w = 2;
var P2 = class {
  constructor(e3, s, t7) {
    this._techniqueRepository = e3, this._rctx = s, this._requestRender = t7, this._enabled = false, this._quadVAO = null, this._passParameters = new t6(), this._drawParameters = new o4();
  }
  dispose() {
    this._quadVAO = a(this._quadVAO);
  }
  disposeOffscreenBuffers() {
    o(this._ssaoFBO, (e3) => e3.resize(0, 0)), o(this._blur0FBO, (e3) => e3.resize(0, 0)), o(this._blur1FBO, (e3) => e3.resize(0, 0));
  }
  set enabled(e3) {
    e3 ? this._enable() : this._disable();
  }
  get enabled() {
    return this._enabled;
  }
  get ready() {
    return this.enabled && r(this._passParameters.noiseTexture) && r(this._ssaoFBO) && r(this._blur0FBO) && r(this._blur1FBO);
  }
  get loading() {
    return this.enabled && !this.ready;
  }
  get colorTexture() {
    return r(this._blur1FBO) ? this._blur1FBO.colorTexture : null;
  }
  get width() {
    return r(this._ssaoFBO) ? this._ssaoFBO.width : -1;
  }
  get height() {
    return r(this._ssaoFBO) ? this._ssaoFBO.height : -1;
  }
  computeSSAO(e3, s, t7) {
    if (!this.enabled || t(s) || t(t7) || t(this._passParameters.noiseTexture) || t(this._ssaoFBO) || t(this._blur0FBO) || t(this._blur1FBO))
      return;
    const a5 = this._rctx, _3 = e3.camera;
    this._passParameters.normalTexture = t7, this._passParameters.depthTexture = s, this._passParameters.projScale = 1 / _3.computeRenderPixelSizeAtDist(1);
    const o5 = _3.fullViewport, u5 = o5[2], l7 = o5[3], m3 = u5 / w, d2 = l7 / w;
    this._ssaoFBO.resize(u5, l7), this._blur0FBO.resize(m3, d2), this._blur1FBO.resize(m3, d2), t(this._quadVAO) && (this._quadVAO = u2(this._rctx)), a5.bindFramebuffer(this._ssaoFBO), a5.setViewport(0, 0, u5, l7);
    a5.bindTechnique(this._ssaoTechnique, this._passParameters, e3).bindDraw(this._drawParameters, e3, this._passParameters), a5.bindVAO(this._quadVAO), a5.drawArrays(E.TRIANGLE_STRIP, 0, n3(this._quadVAO, "geometry"));
    const b2 = a5.bindTechnique(this._blurTechnique, this._passParameters, e3);
    a5.setViewport(0, 0, m3, d2), a5.bindFramebuffer(this._blur0FBO), this._drawParameters.colorTexture = this._ssaoFBO.colorTexture, r4(this._drawParameters.blurSize, 0, w / l7), b2.bindDraw(this._drawParameters, e3, this._passParameters), a5.setViewport(0, 0, m3, d2), a5.drawArrays(E.TRIANGLE_STRIP, 0, n3(this._quadVAO, "geometry")), a5.bindFramebuffer(this._blur1FBO), this._drawParameters.colorTexture = this._blur0FBO.colorTexture, r4(this._drawParameters.blurSize, w / u5, 0), b2.bindDraw(this._drawParameters, e3, this._passParameters), a5.drawArrays(E.TRIANGLE_STRIP, 0, n3(this._quadVAO, "geometry")), a5.setViewport(o5[0], o5[1], o5[2], o5[3]);
  }
  _selectPrograms() {
    t(this._ssaoTechnique) && (this._ssaoTechnique = this._techniqueRepository.acquire(l3)), t(this._blurTechnique) && (this._blurTechnique = this._techniqueRepository.acquire(l2));
  }
  _enable() {
    this.enabled || (this._enabled = true, this._loadResources(() => {
      this._enabled && this._initialize();
    }));
  }
  _loadResources(e3) {
    this._data ? e3() : import("./SSAOHelperData-6VG6WIN2.js").then((s) => {
      this._data = s, e3();
    });
  }
  _initialize() {
    const e3 = { target: M.TEXTURE_2D, pixelFormat: P.RGBA, dataType: G.UNSIGNED_BYTE, samplingMode: L.LINEAR, wrapMode: D.CLAMP_TO_EDGE, width: 0, height: 0 }, s = { colorTarget: Y.TEXTURE, depthStencilTarget: V.NONE };
    t3(this._data.noiseTexture).then((t7) => {
      this._enabled && (this._ssaoFBO = new x(this._rctx, s, e3), this._blur0FBO = new x(this._rctx, s, e3), this._blur1FBO = new x(this._rctx, s, e3), this._passParameters.noiseTexture = new E2(this._rctx, { target: M.TEXTURE_2D, pixelFormat: P.RGBA, dataType: G.UNSIGNED_BYTE, hasMipmap: true, width: t7.width, height: t7.height }, t7), this._requestRender());
    }), this._selectPrograms();
  }
  _disable() {
    this._enabled = false, this._passParameters.noiseTexture = a(this._passParameters.noiseTexture), this._blur1FBO = a(this._blur1FBO), this._blur0FBO = a(this._blur0FBO), this._ssaoFBO = a(this._ssaoFBO);
  }
  get gpuMemoryUsage() {
    return (r(this._blur0FBO) ? this._blur0FBO.gpuMemoryUsage : 0) + (r(this._blur1FBO) ? this._blur1FBO.gpuMemoryUsage : 0) + (r(this._ssaoFBO) ? this._ssaoFBO.gpuMemoryUsage : 0);
  }
  get test() {
    return { ssao: this._ssaoFBO, blur: this._blur1FBO };
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lighting/Lightsources.js
var i = class {
  constructor(s = n()) {
    this.intensity = s;
  }
};
var c2 = class {
  constructor(i2 = n(), c3 = r2(0.57735, 0.57735, 0.57735)) {
    this.intensity = i2, this.direction = c3;
  }
};
var n4 = class {
  constructor(i2 = n(), c3 = r2(0.57735, 0.57735, 0.57735), n6 = true, r7 = 1, h2 = 1) {
    this.intensity = i2, this.direction = c3, this.castShadows = n6, this.specularStrength = r7, this.environmentStrength = h2;
  }
};
var r6 = class {
  constructor() {
    this.r = [0], this.g = [0], this.b = [0];
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/LongVectorMath.js
function n5(t7, n6, e3) {
  (e3 = e3 || t7).length = t7.length;
  for (let l7 = 0; l7 < t7.length; l7++)
    e3[l7] = t7[l7] * n6[l7];
  return e3;
}
function e2(t7, n6, e3) {
  (e3 = e3 || t7).length = t7.length;
  for (let l7 = 0; l7 < t7.length; l7++)
    e3[l7] = t7[l7] * n6;
  return e3;
}
function l4(t7, n6, e3) {
  (e3 = e3 || t7).length = t7.length;
  for (let l7 = 0; l7 < t7.length; l7++)
    e3[l7] = t7[l7] + n6[l7];
  return e3;
}

// node_modules/@arcgis/core/views/3d/webgl-engine/lighting/SphericalHarmonics.js
function u4(t7) {
  return (t7 + 1) * (t7 + 1);
}
function l5(n6) {
  return a2(Math.floor(Math.sqrt(n6) - 1), 0, 2);
}
function m(t7, n6, o5) {
  const r7 = t7[0], e3 = t7[1], s = t7[2], i2 = o5 || [];
  return i2.length = u4(n6), n6 >= 0 && (i2[0] = 0.28209479177), n6 >= 1 && (i2[1] = 0.4886025119 * r7, i2[2] = 0.4886025119 * s, i2[3] = 0.4886025119 * e3), n6 >= 2 && (i2[4] = 1.09254843059 * r7 * e3, i2[5] = 1.09254843059 * e3 * s, i2[6] = 0.31539156525 * (3 * s * s - 1), i2[7] = 1.09254843059 * r7 * s, i2[8] = 0.54627421529 * (r7 * r7 - e3 * e3)), i2;
}
function p(t7, n6) {
  const o5 = u4(t7), r7 = n6 || { r: [], g: [], b: [] };
  r7.r.length = r7.g.length = r7.b.length = o5;
  for (let e3 = 0; e3 < o5; e3++)
    r7.r[e3] = r7.g[e3] = r7.b[e3] = 0;
  return r7;
}
function y(t7, o5) {
  const r7 = l5(o5.r.length);
  for (const e3 of t7)
    j(P3, e3.direction), m(P3, r7, v), n5(v, k), e2(v, e3.intensity[0], I), l4(o5.r, I), e2(v, e3.intensity[1], I), l4(o5.g, I), e2(v, e3.intensity[2], I), l4(o5.b, I);
  return o5;
}
function b(t7, n6) {
  m(P3, 0, v);
  for (const o5 of t7)
    n6.r[0] += v[0] * k[0] * o5.intensity[0] * 4 * Math.PI, n6.g[0] += v[0] * k[0] * o5.intensity[1] * 4 * Math.PI, n6.b[0] += v[0] * k[0] * o5.intensity[2] * 4 * Math.PI;
  return n6;
}
function M2(t7, n6, e3, s) {
  p(n6, s), o2(e3.intensity, 0, 0, 0);
  let i2 = false;
  const u5 = S, l7 = d, m3 = j2;
  u5.length = 0, l7.length = 0, m3.length = 0;
  for (const o5 of t7)
    o5 instanceof n4 && !i2 ? (r3(e3.direction, o5.direction), r3(e3.intensity, o5.intensity), e3.specularStrength = o5.specularStrength, e3.environmentStrength = o5.environmentStrength, e3.castShadows = o5.castShadows, i2 = true) : o5 instanceof n4 || o5 instanceof c2 ? u5.push(o5) : o5 instanceof i ? l7.push(o5) : o5 instanceof r6 && m3.push(o5);
  y(u5, s), b(l7, s);
  for (const o5 of m3)
    l4(s.r, o5.r), l4(s.g, o5.g), l4(s.b, o5.b);
}
var S = [];
var d = [];
var j2 = [];
var v = [0];
var I = [0];
var P3 = n();
var k = [3.141593, 2.094395, 2.094395, 2.094395, 0.785398, 0.785398, 0.785398, 0.785398, 0.785398];

// node_modules/@arcgis/core/views/3d/webgl-engine/lighting/SceneLighting.js
var m2 = class {
  constructor() {
    this.color = n(), this.intensity = 1;
  }
};
var l6 = class {
  constructor() {
    this.direction = n(), this.ambient = new m2(), this.diffuse = new m2();
  }
};
var _2 = 0.4;
var L2 = class {
  constructor() {
    this._shOrder = 2, this._legacy = new l6(), this.globalFactor = 0.5, this.noonFactor = 0.5, this._sphericalHarmonics = new r6(), this._mainLight = new n4(n(), r2(1, 0, 0), false);
  }
  get legacy() {
    return this._legacy;
  }
  get sh() {
    return this._sphericalHarmonics;
  }
  get mainLight() {
    return this._mainLight;
  }
  set(i2) {
    M2(i2, this._shOrder, this._mainLight, this._sphericalHarmonics), r3(this._legacy.direction, this._mainLight.direction);
    const r7 = 1 / Math.PI;
    this._legacy.ambient.color[0] = 0.282095 * this._sphericalHarmonics.r[0] * r7, this._legacy.ambient.color[1] = 0.282095 * this._sphericalHarmonics.g[0] * r7, this._legacy.ambient.color[2] = 0.282095 * this._sphericalHarmonics.b[0] * r7, g(this._legacy.diffuse.color, this._mainLight.intensity, r7), r3(p2, this._legacy.diffuse.color), g(p2, p2, _2 * this.globalFactor), u(this._legacy.ambient.color, this._legacy.ambient.color, p2);
  }
  copyFrom(i2) {
    this._sphericalHarmonics.r = Array.from(i2.sh.r), this._sphericalHarmonics.g = Array.from(i2.sh.g), this._sphericalHarmonics.b = Array.from(i2.sh.b), this._mainLight.direction = t2(i2.mainLight.direction), this._mainLight.intensity = t2(i2.mainLight.intensity), this._mainLight.castShadows = i2.mainLight.castShadows, this._mainLight.specularStrength = i2.mainLight.specularStrength, this._mainLight.environmentStrength = i2.mainLight.environmentStrength, this.globalFactor = i2.globalFactor, this.noonFactor = i2.noonFactor;
  }
  lerpLighting(s, h2, n6) {
    if (A(this._mainLight.intensity, s.mainLight.intensity, h2.mainLight.intensity, n6), this._mainLight.environmentStrength = h(s.mainLight.environmentStrength, h2.mainLight.environmentStrength, n6), this._mainLight.specularStrength = h(s.mainLight.specularStrength, h2.mainLight.specularStrength, n6), r3(this._mainLight.direction, h2.mainLight.direction), this._mainLight.castShadows = h2.mainLight.castShadows, this.globalFactor = h(s.globalFactor, h2.globalFactor, n6), this.noonFactor = h(s.noonFactor, h2.noonFactor, n6), s.sh.r.length === h2.sh.r.length)
      for (let t7 = 0; t7 < h2.sh.r.length; t7++)
        this._sphericalHarmonics.r[t7] = h(s.sh.r[t7], h2.sh.r[t7], n6), this._sphericalHarmonics.g[t7] = h(s.sh.g[t7], h2.sh.g[t7], n6), this._sphericalHarmonics.b[t7] = h(s.sh.b[t7], h2.sh.b[t7], n6);
    else
      for (let i2 = 0; i2 < h2.sh.r.length; i2++)
        this._sphericalHarmonics.r[i2] = h2.sh.r[i2], this._sphericalHarmonics.g[i2] = h2.sh.g[i2], this._sphericalHarmonics.b[i2] = h2.sh.b[i2];
  }
};
var p2 = n();

export {
  t5 as t,
  e,
  o3 as o,
  w,
  P2 as P,
  i,
  _2 as _,
  L2 as L
};
//# sourceMappingURL=chunk-HP6QT5KY.js.map
