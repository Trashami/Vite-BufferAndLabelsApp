{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/featureSources/FeatureCollectionSnappingSource.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import{isSome as o}from\"../../../../core/maybe.js\";import{throwIfAborted as r,whenOrAbort as i}from\"../../../../core/promiseUtils.js\";import{watch as n,initial as a}from\"../../../../core/reactiveUtils.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{elevationContextAffectsAlignment as l,absoluteHeightElevationInfo as y}from\"../../../../support/elevationInfoUtils.js\";import{makeFilter as c,makeSnappingQuery as g}from\"../snappingUtils.js\";import{convertSnappingCandidate as u,makeGetGroundElevation as h}from\"./queryEngineUtils.js\";import{getSnappingCandidateElevationAligner as m}from\"./snappingCandidateElevationAlignment.js\";import{getSnappingCandidateElevationFilter as d}from\"./snappingCandidateElevationFilter.js\";import{getSymbologySnappingCandidatesFetcher as v}from\"./symbologySnappingCandidates.js\";let f=class extends t{constructor(e){super(e),this.view=null,this._layerView3D=null}get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,r=o(e)&&\"3d\"===e.type;if(!r||\"subtype-group\"===t.type)return m();const n=async(o,r)=>(await i(e.whenLayerView(t),r)).elevationAlignPointsInFeatures(o,r);return m(r,{elevationInfo:t.elevationInfo,alignPointsInFeatures:n,spatialReference:e.spatialReference})}get _snappingElevationFilter(){const{view:e}=this,t=o(e)&&\"3d\"===e.type&&\"subtype-group\"!==this.layerSource.layer.type;return d(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return o(e)&&\"3d\"===e.type&&\"subtype-group\"!==t.type?v(this._symbologySnappingSupported,(async(o,i)=>{const n=await e.whenLayerView(t);return r(i),n.queryForSymbologySnapping({candidates:o,spatialReference:e.spatialReference},i)})):v()}get _symbologySnappingSupported(){return o(this._layerView3D)&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;o(e)&&\"3d\"===e.type&&\"subtype-group\"!==t.type&&(e.whenLayerView(t).then((e=>this._layerView3D=e)),this.addHandles([e.elevationProvider.on(\"elevation-change\",(({context:e})=>{const{elevationInfo:o}=t;l(e,o)&&this._snappingElevationAligner.notifyElevationSourceChange()})),n((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),a),n((()=>o(this._layerView3D)?this._layerView3D.processor?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),a)]))}refresh(){}async fetchCandidates(e,t){const{layer:o}=this.layerSource,{coordinateHelper:i,elevationInfo:n}=e,a=o.source;if(!a.querySnapping)return[];const s=c(o),p=g(e,s),l=await a.querySnapping(p,{signal:t});r(t);const h=await this._snappingElevationAligner.alignCandidates(l.candidates,t);r(t);const m=await this._symbologySnappingFetcher.fetch(h,t);r(t);const d=0===m.length?h:[...h,...m],v=this._snappingElevationFilter.filter(p,d),f=i.hasZ()?y:n,S=this._getGroundElevation;return v.map((e=>u(e,i,f,S)))}get _getGroundElevation(){return h(this.view)}};e([s({constructOnly:!0})],f.prototype,\"layerSource\",void 0),e([s({constructOnly:!0})],f.prototype,\"view\",void 0),e([s()],f.prototype,\"_snappingElevationAligner\",null),e([s()],f.prototype,\"_snappingElevationFilter\",null),e([s()],f.prototype,\"_symbologySnappingFetcher\",null),e([s()],f.prototype,\"_layerView3D\",void 0),e([s()],f.prototype,\"_symbologySnappingSupported\",null),e([s()],f.prototype,\"_getGroundElevation\",null),f=e([p(\"esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource\")],f);export{f as FeatureCollectionSnappingSource};\n"],
  "mappings": "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",
  "names": ["f", "e", "r", "n", "y", "a", "m", "h", "l"]
}
