{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/tiling/TileQueue.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import{destroyMaybe as s}from\"../../../core/maybe.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import{d as i}from\"../../../chunks/vec2.js\";import{QueueProcessor as n}from\"../../support/QueueProcessor.js\";function u(e,t){return e.length=0,t.forEach((t=>e.push(t))),e}const c=new Set,a=[],h=new Map,l=[0,0];let p=class extends t{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy=\"scale-first\",this.tileInfoView=null}initialize(){const{concurrency:e,process:t,strategy:s}=this;this._queue=new n({concurrency:e,process:(e,s)=>{const r=this._keyToItem.get(e);return t(r,{signal:s})},peeker:\"scale-first\"===s?e=>this._peekByScaleFirst(e):e=>this._peekByCenterFirst(e)})}destroy(){this.clear(),this._queue=s(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const t=\"string\"==typeof e?e:e.id;this._queue.abort(t)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange(\"updating\")}has(e){return\"string\"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const t=\"string\"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}pause(){this._queue.pause()}push(e){const t=e.key.id;if(this._queue.has(t))return this._queue.get(t);const s=this._queue.push(t),r=()=>{this._keyToItem.delete(t),this.notifyChange(\"updating\")};return this._keyToItem.set(t,e),s.then(r,r),this.notifyChange(\"updating\"),s}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView;let s=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;e.forEach((e=>{const t=this._keyToItem.get(e),o=this.tileInfoView.getTileScale(t.key);h.has(o)||(h.set(o,[]),s=Math.max(o,s),r=Math.min(o,r)),h.get(o).push(t.key),c.add(o)}));let o=this.state.scale;h.has(o)||(u(a,c),a.sort(((e,t)=>e-t)),o=a.reduce(((e,t)=>Math.abs(t-o)<Math.abs(e-o)?t:e),a[0])),o=Math.min(o,s),o=Math.max(o,r);const i=h.get(o),n=t.getClosestInfoForScale(o),l=n.getColumnForX(this.state.center[0]),p=n.getRowForY(this.state.center[1]);return i.sort(((e,t)=>{const s=n.denormalizeCol(e.col,e.world),r=n.denormalizeCol(t.col,t.world);return Math.sqrt((l-s)*(l-s)+(p-e.row)*(p-e.row))-Math.sqrt((l-r)*(l-r)+(p-t.row)*(p-t.row))})),c.clear(),h.clear(),i[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView,s=this.state.center;let r,o=Number.POSITIVE_INFINITY;return e.forEach((e=>{const n=this._keyToItem.get(e);t.getTileCoords(l,n.key);const u=i(l,s);u<o&&(o=u,r=n.key)})),r.id}};e([r({constructOnly:!0})],p.prototype,\"concurrency\",void 0),e([r({constructOnly:!0})],p.prototype,\"process\",void 0),e([r()],p.prototype,\"state\",void 0),e([r({constructOnly:!0})],p.prototype,\"strategy\",void 0),e([r({constructOnly:!0})],p.prototype,\"tileInfoView\",void 0),e([r({readOnly:!0})],p.prototype,\"updating\",null),p=e([o(\"esri.views.2d.tiling.TileQueue\")],p);const y=p;export{y as default};\n"],
  "mappings": "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",
  "names": ["e", "t", "l", "s", "o", "n", "p", "r", "u", "m", "y"]
}
