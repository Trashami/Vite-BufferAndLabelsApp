{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js", "../../@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{z as s,i as o,a as r}from\"../../../../../chunks/vec3.js\";import{c,g as n}from\"../../../../../chunks/sphere.js\";const t=1e3;function a(t,a,e){const i=c(),m=n(i);return s(m,m,t,.5),s(m,m,a,.5),i[3]=o(m,t),r(m,m,e),i}export{t as MAX_CANDIDATE_COUNT,a as boundsFromEdge};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{isNone as t,unwrapOr as s}from\"../../../../../core/maybe.js\";import{throwIfAborted as o}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import\"../../../../../core/Error.js\";import\"../../../../../core/has.js\";import{subclass as n}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{a as i,i as r}from\"../../../../../chunks/vec3.js\";import{c as d,a as c}from\"../../../../../chunks/vec3f64.js\";import{create as a,fromPoints as p,projectPoint as m}from\"../../../../../geometry/support/lineSegment.js\";import{g as u,m as h}from\"../../../../../chunks/sphere.js\";import{SnappingTypes as g}from\"../../../../../layers/graphics/data/QueryEngineResult.js\";import l from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as f}from\"../../../../3d/webgl-engine/lib/edgeRendering/edgeProcessing.js\";import{MAX_CANDIDATE_COUNT as _,boundsFromEdge as b}from\"./sceneLayerSnappingUtils.js\";let j=class{constructor(){this._idToComponent=new Map,this._components=new l((e=>e.bounds)),this._edges=new l((e=>e.bounds)),this._tmpLineSegment=a(),this._tmpP1=d(),this._tmpP2=d(),this._tmpP3=d(),this.remoteClient=null}async fetchCandidates(e,t){await Promise.resolve(),o(t),await this._ensureEdgeLocations(e,t);const s=[];return this._edges.forEachNeighbor((t=>(this._addCandidates(e,t,s),s.length<_)),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,o){const n=[];if(this._components.forEachNeighbor((e=>{if(t(e.info)){const{id:t,uid:s}=e;n.push({id:t,uid:s})}return!0}),e.bounds),!n.length)return;const i={components:n},r=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",i,s(o,{}));for(const t of r.components)this._setFetchEdgeLocations(t)}async add(e){const t=new E(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((s=>(s.component===t&&e.push(s),!0)),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const s=this._idToComponent.get(e.id);if(t(s)||e.uid!==s.uid)return;const o=f.createView(e.locations),n=new Array(o.count),i=d(),r=d();for(let t=0;t<o.count;t++){o.position0.getVec(t,i),o.position1.getVec(t,r);const d=b(i,r,e.origin),c=new C(s,t,d);n[t]=c}this._edges.add(n);const{objectIds:c,origin:a}=e;s.info={locations:o,objectIds:c,origin:a}}_addCandidates(e,t,s){const{locations:o,origin:n,objectIds:r}=t.component.info,d=o.position0.getVec(t.index,this._tmpP1),c=o.position1.getVec(t.index,this._tmpP2);i(d,d,n),i(c,c,n);const a=r[o.componentIndex.get(t.index)];this._addEdgeCandidate(e,a,d,c,s),this._addVertexCandidate(e,a,d,s),this._addVertexCandidate(e,a,c,s)}_addEdgeCandidate(e,t,s,o,n){if(!(e.types&g.EDGE))return;const i=u(e.bounds),d=p(s,o,this._tmpLineSegment),a=m(d,i,this._tmpP3);if(!h(e.bounds,a))return null;n.push({type:\"edge\",objectId:t,target:c(a),distance:r(i,a),start:c(s),end:c(o)})}_addVertexCandidate(e,t,s,o){if(!(e.types&g.VERTEX))return;const n=u(e.bounds);if(!h(e.bounds,s))return null;o.push({type:\"vertex\",objectId:t,target:c(s),distance:r(n,s)})}};j=e([n(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],j);const y=j;class E{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++E.uid}}E.uid=0;class C{constructor(e,t,s){this.component=e,this.index=t,this.bounds=s}}export{y as default};\n"],
  "mappings": "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",
  "names": ["t", "a", "e", "i", "m", "j", "e", "t", "n", "i", "c", "a", "q"]
}
