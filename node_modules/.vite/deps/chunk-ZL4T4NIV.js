import {
  f as f2,
  h as h2,
  o,
  r as r2,
  s as s4,
  t as t2,
  w
} from "./chunk-NAKEKTIK.js";
import {
  a as a2
} from "./chunk-ZPYDYUP5.js";
import {
  a,
  a2 as a3,
  c,
  r
} from "./chunk-ZHAW7FZS.js";
import {
  Q
} from "./chunk-KAN4HXCG.js";
import {
  l
} from "./chunk-4FEGON7M.js";
import {
  t
} from "./chunk-6KZ2LTDA.js";
import {
  C,
  d,
  f,
  j
} from "./chunk-MJXQTGI2.js";
import {
  s as s3
} from "./chunk-LIZHLHNA.js";
import {
  s,
  s2
} from "./chunk-UA3YPL2R.js";
import {
  has
} from "./chunk-HVKDYDPP.js";
import {
  h
} from "./chunk-MIHB3CIK.js";

// node_modules/@arcgis/core/core/workers/loaderConfig.js
var a4 = {};
function e(s6, a7) {
  for (const e2 of s6)
    if (e2.name === a7.name)
      return;
  s6.push(a7);
}
function r3(s6) {
  var _a;
  const r4 = { async: s6.async, isDebug: s6.isDebug, locale: s6.locale, baseUrl: s6.baseUrl, has: { ...s6.has }, map: { ...s6.map }, packages: s6.packages && s6.packages.concat() || [], paths: { ...s6.paths } };
  return s6.hasOwnProperty("async") || (r4.async = true), s6.hasOwnProperty("isDebug") || (r4.isDebug = false), s6.baseUrl || (r4.baseUrl = a4.baseUrl), (_a = a4.packages) == null ? void 0 : _a.forEach((s7) => {
    var _a2;
    e((_a2 = r4.packages) != null ? _a2 : [], s7);
  }), r4;
}

// node_modules/@arcgis/core/core/workers/WorkerFallback.js
var n = class {
  constructor() {
    const e2 = document.createDocumentFragment();
    ["addEventListener", "dispatchEvent", "removeEventListener"].forEach((s6) => {
      this[s6] = (...r4) => e2[s6](...r4);
    });
  }
};
var a5 = class {
  constructor() {
    this._dispatcher = new n(), this._workerPostMessage({ type: t2.HANDSHAKE });
  }
  terminate() {
  }
  get onmessage() {
    return this._onmessageHandler;
  }
  set onmessage(e2) {
    this._onmessageHandler && this.removeEventListener("message", this._onmessageHandler), this._onmessageHandler = e2, e2 && this.addEventListener("message", e2);
  }
  get onmessageerror() {
    return this._onmessageerrorHandler;
  }
  set onmessageerror(e2) {
    this._onmessageerrorHandler && this.removeEventListener("messageerror", this._onmessageerrorHandler), this._onmessageerrorHandler = e2, e2 && this.addEventListener("messageerror", e2);
  }
  get onerror() {
    return this._onerrorHandler;
  }
  set onerror(e2) {
    this._onerrorHandler && this.removeEventListener("error", this._onerrorHandler), this._onerrorHandler = e2, e2 && this.addEventListener("error", e2);
  }
  postMessage(s6) {
    t(() => {
      this._workerMessageHandler(new MessageEvent("message", { data: s6 }));
    });
  }
  dispatchEvent(e2) {
    return this._dispatcher.dispatchEvent(e2);
  }
  addEventListener(e2, s6, r4) {
    this._dispatcher.addEventListener(e2, s6, r4);
  }
  removeEventListener(e2, s6, r4) {
    this._dispatcher.removeEventListener(e2, s6, r4);
  }
  _workerPostMessage(s6) {
    t(() => {
      this.dispatchEvent(new MessageEvent("message", { data: s6 }));
    });
  }
  async _workerMessageHandler(e2) {
    const n2 = f2(e2);
    if (n2 && n2.type === t2.OPEN) {
      const { modulePath: e3, jobId: t3 } = n2;
      let a7 = await w.loadWorker(e3);
      a7 || (a7 = await import(
        /* @vite-ignore */
        /* webpackIgnore: true */
        e3
      ));
      const o2 = w.connect(a7);
      this._workerPostMessage({ type: t2.OPENED, jobId: t3, data: o2 });
    }
  }
};

// node_modules/@arcgis/core/core/workers/workerFactory.js
var u = s2.getLogger("esri.core.workers.workerFactory");
var { HANDSHAKE: m } = t2;
var p = 'let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';
var g;
var k;
var h3 = "Failed to create Worker. Fallback to execute module in main thread";
async function w2() {
  if (!has("esri-workers") || (has("mozilla"), 0))
    return y(new a5());
  if (!g && !k)
    try {
      const e3 = p.split('"{CONFIGURATION}"').join(`'${b()}'`);
      g = URL.createObjectURL(new Blob([e3], { type: "text/javascript" }));
    } catch (r4) {
      k = r4 || {};
    }
  let e2;
  if (g)
    try {
      e2 = new Worker(g, { name: "esri-worker-" + v++ });
    } catch (r4) {
      u.warn(h3, k), e2 = new a5();
    }
  else
    u.warn(h3, k), e2 = new a5();
  return y(e2);
}
async function y(e2) {
  return new Promise((r4) => {
    function o2(s6) {
      const n2 = f2(s6);
      n2 && n2.type === m && (e2.removeEventListener("message", o2), e2.removeEventListener("error", t3), r4(e2));
    }
    function t3(r5) {
      r5.preventDefault(), e2.removeEventListener("message", o2), e2.removeEventListener("error", t3), u.warn("Failed to create Worker. Fallback to execute module in main thread", r5), (e2 = new a5()).addEventListener("message", o2), e2.addEventListener("error", t3);
    }
    e2.addEventListener("message", o2), e2.addEventListener("error", t3);
  });
}
function b() {
  let t3;
  if (null != s.default) {
    const e2 = { ...s };
    delete e2.default, t3 = JSON.parse(JSON.stringify(e2));
  } else
    t3 = JSON.parse(JSON.stringify(s));
  t3.assetsPath = Q(t3.assetsPath), t3.defaultAssetsPath = t3.defaultAssetsPath ? Q(t3.defaultAssetsPath) : void 0, t3.request.interceptors = [], t3.log.interceptors = [], t3.locale = l(), t3.has = { "esri-csp-restrictions": has("esri-csp-restrictions"), "esri-2d-debug": false, "esri-2d-update-debug": has("esri-2d-update-debug"), "featurelayer-pbf": has("featurelayer-pbf"), "featurelayer-simplify-thresholds": has("featurelayer-simplify-thresholds"), "featurelayer-simplify-payload-size-factors": has("featurelayer-simplify-payload-size-factors"), "featurelayer-simplify-mobile-factor": has("featurelayer-simplify-mobile-factor"), "esri-atomics": has("esri-atomics"), "esri-shared-array-buffer": has("esri-shared-array-buffer"), "esri-tiles-debug": has("esri-tiles-debug"), "esri-workers-arraybuffer-transfer": has("esri-workers-arraybuffer-transfer"), "feature-polyline-generalization-factor": has("feature-polyline-generalization-factor"), "host-webworker": 1, "polylabel-placement-enabled": has("polylabel-placement-enabled") }, t3.workers.loaderUrl && (t3.workers.loaderUrl = Q(t3.workers.loaderUrl)), t3.workers.workerPath ? t3.workers.workerPath = Q(t3.workers.workerPath) : t3.workers.workerPath = Q(a2("esri/core/workers/RemoteClient.js")), t3.workers.useDynamicImport = false;
  const i2 = s.workers.loaderConfig, a7 = r3({ baseUrl: i2 == null ? void 0 : i2.baseUrl, locale: l(), has: { "csp-restrictions": 1, "dojo-test-sniff": 0, "host-webworker": 1, ...i2 == null ? void 0 : i2.has }, map: { ...i2 == null ? void 0 : i2.map }, paths: { ...i2 == null ? void 0 : i2.paths }, packages: (i2 == null ? void 0 : i2.packages) || [] }), l3 = { version: a3, buildDate: c, revision: a };
  return JSON.stringify({ esriConfig: t3, loaderConfig: a7, kernelInfo: l3 });
}
var v = 0;

// node_modules/@arcgis/core/core/workers/WorkerOwner.js
var { ABORT: b2, INVOKE: m2, OPEN: _, OPENED: g2, RESPONSE: u2 } = t2;
var j2 = class {
  constructor(e2, t3) {
    this._outJobs = /* @__PURE__ */ new Map(), this._inJobs = /* @__PURE__ */ new Map(), this.worker = e2, this.id = t3, e2.addEventListener("message", this._onMessage.bind(this)), e2.addEventListener("error", (e3) => {
      e3.preventDefault(), s2.getLogger("esri.core.workers.WorkerOwner").error(e3);
    });
  }
  static async create(e2) {
    const t3 = await w2();
    return new j2(t3, e2);
  }
  terminate() {
    this.worker.terminate();
  }
  async open(e2, t3 = {}) {
    const { signal: o2 } = t3, s6 = r2();
    return new Promise((t4, n2) => {
      const a7 = { resolve: t4, reject: n2, abortHandle: d(o2, () => {
        this._outJobs.delete(s6), this._post({ type: b2, jobId: s6 });
      }) };
      this._outJobs.set(s6, a7), this._post({ type: _, jobId: s6, modulePath: e2 });
    });
  }
  _onMessage(e2) {
    const t3 = f2(e2);
    if (t3)
      switch (t3.type) {
        case g2:
          this._onOpenedMessage(t3);
          break;
        case u2:
          this._onResponseMessage(t3);
          break;
        case b2:
          this._onAbortMessage(t3);
          break;
        case m2:
          this._onInvokeMessage(t3);
      }
  }
  _onAbortMessage(e2) {
    const t3 = this._inJobs, o2 = e2.jobId, s6 = t3.get(o2);
    s6 && (s6.controller && s6.controller.abort(), t3.delete(o2));
  }
  _onInvokeMessage(t3) {
    const { methodName: o2, jobId: s6, data: r4, abortable: i2 } = t3, l3 = i2 ? new AbortController() : null, h4 = this._inJobs, c2 = r[o2];
    let p3;
    try {
      if ("function" != typeof c2)
        throw new TypeError(`${o2} is not a function`);
      p3 = c2.call(null, r4, { signal: l3 ? l3.signal : null });
    } catch (b3) {
      return void this._post({ type: u2, jobId: s6, error: s4(b3) });
    }
    C(p3) ? (h4.set(s6, { controller: l3, promise: p3 }), p3.then((e2) => {
      h4.has(s6) && (h4.delete(s6), this._post({ type: u2, jobId: s6 }, e2));
    }, (e2) => {
      h4.has(s6) && (h4.delete(s6), e2 || (e2 = { message: "Error encountered at method" + o2 }), j(e2) || this._post({ type: u2, jobId: s6, error: s4(e2 || { message: `Error encountered at method ${o2}` }) }));
    })) : this._post({ type: u2, jobId: s6 }, p3);
  }
  _onOpenedMessage(e2) {
    const { jobId: t3, data: o2 } = e2, r4 = this._outJobs.get(t3);
    r4 && (this._outJobs.delete(t3), h(r4.abortHandle), r4.resolve(o2));
  }
  _onResponseMessage(e2) {
    const { jobId: o2, error: r4, data: n2 } = e2, a7 = this._outJobs.get(o2);
    a7 && (this._outJobs.delete(o2), h(a7.abortHandle), r4 ? a7.reject(s3.fromJSON(JSON.parse(r4))) : a7.resolve(n2));
  }
  _post(e2, t3, o2) {
    return o(this.worker, e2, t3, o2);
  }
};

// node_modules/@arcgis/core/core/workers/workers.js
var i = has("esri-workers-debug") ? 1 : has("esri-mobile") ? Math.min(navigator.hardwareConcurrency - 1, 3) : has("host-browser") ? navigator.hardwareConcurrency - 1 : 0;
i || (i = has("safari") && has("mac") || has("trident") ? 7 : 2);
var a6 = 0;
var s5 = [];
function l2() {
  d2();
}
async function m3(r4, t3) {
  const o2 = new h2();
  return await o2.open(r4, t3), o2;
}
async function u3(e2, n2 = {}) {
  if ("string" != typeof e2)
    throw new s3("workers:undefined-module", "modulePath is missing");
  let l3 = n2.strategy || "distributed";
  if (has("host-webworker") && !has("esri-workers") && (l3 = "local"), "local" === l3) {
    let r4 = await w.loadWorker(e2);
    r4 || (r4 = await import(
      /* @vite-ignore */
      /* webpackIgnore: true */
      e2
    )), f(n2.signal);
    const i2 = n2.client || r4;
    return m3([w.connect(r4)], { ...n2, client: i2 });
  }
  if (await d2(), f(n2.signal), "dedicated" === l3) {
    const r4 = a6++ % i;
    return m3([await s5[r4].open(e2, n2)], n2);
  }
  if (n2.maxNumWorkers && n2.maxNumWorkers > 0) {
    const r4 = Math.min(n2.maxNumWorkers, i);
    if (r4 < i) {
      const t3 = new Array(r4);
      for (let o2 = 0; o2 < r4; ++o2) {
        const r5 = a6++ % i;
        t3[o2] = s5[r5].open(e2, n2);
      }
      return m3(t3, n2);
    }
  }
  return m3(s5.map((r4) => r4.open(e2, n2)), n2);
}
var w3;
var p2 = null;
async function d2() {
  if (p2)
    return p2;
  w3 = new AbortController();
  const r4 = [];
  for (let t3 = 0; t3 < i; t3++) {
    const e2 = j2.create(t3).then((r5) => (s5[t3] = r5, r5));
    r4.push(e2);
  }
  return p2 = Promise.all(r4), p2;
}

export {
  l2 as l,
  u3 as u
};
//# sourceMappingURL=chunk-ZL4T4NIV.js.map
