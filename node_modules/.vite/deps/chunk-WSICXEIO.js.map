{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/layers/features/support/TileStore.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Evented.js\";import has from\"../../../../../core/has.js\";import{r as t}from\"../../../../../chunks/rbush.js\";import{Tile as s}from\"./Tile.js\";import i from\"../../../tiling/TileCoverage.js\";import o from\"../../../tiling/TileKey.js\";const h={added:[],removed:[]},n=new Set,r=new o(0,0,0,0);class d extends e{constructor(e){super(),this._tiles=new Map,this._index=t(9,has(\"esri-csp-restrictions\")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[\".bounds[0]\",\".bounds[1]\",\".bounds[2]\",\".bounds[3]\"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const i of e.added)if(!this.has(i)){const e=new s(this.tileScheme,i);this._tiles.set(i,e),this._index.insert(e),t.added.push(e)}for(const s of e.removed)if(this.has(s)){const e=this.get(s);this._tiles.delete(s),this._index.remove(e),t.removed.push(e)}this.tiles.length=0,this._tiles.forEach((e=>this.tiles.push(e))),(t.added.length||t.removed.length)&&this.emit(\"update\",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:o,lodInfo:d}=t,{level:l}=d;if(o.length>0)for(const{row:i,colFrom:a,colTo:m}of o)for(let e=a;e<=m;e++){const t=r.set(l,i,d.normalizeCol(e),d.getWorldForColumn(e)).id;if(n.add(t),!this.has(t)){const e=new s(this.tileScheme,t);this._tiles.set(t,e),this._index.insert(e),this.tiles.push(e),h.added.push(e)}}for(let s=this.tiles.length-1;s>=0;s--){const e=this.tiles[s];n.has(e.id)||(this._tiles.delete(e.id),this.tiles.splice(s,1),this._index.remove(e),h.removed.push(e))}(h.added.length||h.removed.length)&&this.emit(\"update\",h),i.pool.release(t),n.clear(),h.added.length=0,h.removed.length=0}}export{d as default};\n"],
  "mappings": "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",
  "names": ["n", "e", "i", "d", "l", "t"]
}
