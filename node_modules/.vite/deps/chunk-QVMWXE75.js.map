{
  "version": 3,
  "sources": ["../../@arcgis/core/support/requestPresets.js", "../../@arcgis/core/portal/support/layersLoader.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from\"../request.js\";async function n(n){const{data:o}=await e(n,{responseType:\"json\",query:{f:\"json\"}});return o}export{n as requestArcGISServiceJSON};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import t from\"../../layers/Layer.js\";import{isArcGISUrl as r}from\"../../layers/support/arcgisLayerUrl.js\";import a from\"../Portal.js\";import n from\"../PortalItem.js\";import{createForItemRead as o}from\"./jsonContext.js\";import{hasTypeKeyword as l}from\"./portalItemUtils.js\";import{loadStyleRenderer as s}from\"../../renderers/support/styleUtils.js\";import{requestArcGISServiceJSON as i}from\"../../support/requestPresets.js\";async function p(e,t){const r=e.instance.portalItem;if(r&&r.id)return await r.load(t),u(e),y(e,t)}function u(t){const r=t.instance.portalItem;if(!t.supportedTypes.includes(r.type))throw new e(\"portal:invalid-layer-item-type\",\"Invalid layer item type '${type}', expected '${expectedType}'\",{type:r.type,expectedType:t.supportedTypes.join(\", \")})}async function y(e,t){const r=e.instance,a=r.portalItem,{url:n,title:l}=a,i=o(a);if(\"group\"===r.type)return r.read({title:l},i),c(r,e);n&&r.read({url:n},i);const p=await h(e,t);return p&&r.read(p,i),r.resourceReferences={portalItem:a,paths:i.readResourcePaths},\"subtype-group\"!==r.type&&r.read({title:l},i),s(r,i)}function c(t,r){let a;const n=t.portalItem.type,o=r.layerModuleTypeMap,s=l(t.portalItem,\"Oriented Imagery Layer\")??!1;switch(n){case\"Feature Service\":a=s?o.OrientedImageryLayer:o.FeatureLayer;break;case\"Stream Service\":a=o.StreamLayer;break;case\"Scene Service\":a=o.SceneLayer;break;case\"Feature Collection\":a=o.FeatureLayer;break;default:throw new e(\"portal:unsupported-item-type-as-group\",`The item type '${n}' is not supported as a 'IGroupLayer'`)}let i;return a().then((e=>(i=e,h(r)))).then((async e=>{let r=()=>i;if(\"Feature Service\"===n){if(T(e=await b(e,t.portalItem.url)).length){const e=o.SubtypeGroupLayer,t=await e();r=e=>\"SubtypeGroupLayer\"===e.layerType?t:i}return m(t,r,e)}return w(e)>0?m(t,r,e):d(t,r)}))}function d(e,t){return e.portalItem.url?i(e.portalItem.url).then((r=>{function a(e){return{id:e.id,name:e.name}}r&&m(e,t,{layers:r.layers?.map(a),tables:r.tables?.map(a)})})):Promise.resolve()}function m(e,t,r){let a=r.layers||[];const n=r.tables||[];if(\"Feature Collection\"===e.portalItem.type&&(a.forEach((e=>{\"Table\"===e?.layerDefinition?.type&&n.push(e)})),a=a.filter((e=>\"Table\"!==e?.layerDefinition?.type))),\"coverage\"in r){const t=L(r);e.add(t)}a.reverse().forEach((a=>{const n=f(e,t(a),r,a);e.add(n)})),n.reverse().forEach((a=>{const n=f(e,t(a),r,a);e.tables.add(n)}))}function f(e,t,r,n){const o=new t({portalItem:e.portalItem.clone(),layerId:n.id});if(\"subtype-group\"!==o.type&&(o.sublayerTitleMode=\"service-name\"),\"Feature Collection\"===e.portalItem.type){const t={origin:\"portal-item\",portal:e.portalItem.portal||a.getDefault()};o.read(n,t);const l=r.showLegend;null!=l&&o.read({showLegend:l},t)}return o}function h(e,t){if(!1===e.supportsData)return Promise.resolve(void 0);const r=e.instance;return r.portalItem.fetchData(\"json\",t).catch((()=>null)).then((e=>{if(v(r)){let t,a=!0;if(e&&w(e)>0){if(null==r.layerId){const t=T(e);r.layerId=\"subtype-group\"===r.type?t?.[0]:g(e)}t=I(e,r),t&&(1===w(e)&&(a=!1),null!=e.showLegend&&(t.showLegend=e.showLegend))}return a&&\"service-name\"!==r.sublayerTitleMode&&(r.sublayerTitleMode=\"item-title-and-service-name\"),t}return e}))}async function b(e,t){if(null==e?.layers||null==e?.tables){const r=await i(t);(e=e||{}).layers=e.layers||r?.layers,e.tables=e.tables||r?.tables}return e}function g(e){const t=e.layers;if(t&&t.length)return t[0].id;const r=e.tables;return r&&r.length?r[0].id:null}function I(e,t){const{layerId:r}=t,a=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return a&&S(a,t)?a:null}function w(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function v(e){return\"stream\"!==e.type&&\"oriented-imagery\"!==e.type&&\"layerId\"in e}function L(a){const{coverage:o}=a;if(!o)return null;const l=new URL(o);if(o.toLowerCase().includes(\"item.html\")){const e=l.searchParams.get(\"id\"),r=l.origin;return t.fromPortalItem({portalItem:new n({id:e,url:r})})}if(r(o))return t.fromArcGISServerUrl({url:o});throw new e(\"portal:oriented-imagery-layer-coverage\",\"the provided coverage url couldn't be loaded as a layer\")}function T(e){const t=[];return e?.layers?.forEach((e=>{\"SubtypeGroupLayer\"===e.layerType&&t.push(e.id)})),t}function S(e,t){return!(\"feature\"===t.type&&\"layerType\"in e&&\"SubtypeGroupLayer\"===e.layerType||\"subtype-group\"===t.type&&!(\"layerType\"in e))}export{g as getFirstLayerOrTableId,w as getNumLayersAndTables,T as getSubtypeGroupLayerIds,p as load,b as preprocessFSItemData};\n"],
  "mappings": "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",
  "names": ["n", "e", "t", "n", "p", "s", "r", "b", "d", "a"]
}
