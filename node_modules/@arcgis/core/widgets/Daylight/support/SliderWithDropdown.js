/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as o}from"../../../chunks/tslib.es6.js";import{eventKey as e}from"../../../core/events.js";import{unwrap as t,isSome as r}from"../../../core/maybe.js";import{watch as i,initial as n}from"../../../core/reactiveUtils.js";import{property as s}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/arrayUtils.js";import"../../../core/accessorSupport/ensureType.js";import{subclass as d}from"../../../core/accessorSupport/decorators/subclass.js";import p from"../../Slider.js";import{SliderWithDropdownViewModel as l}from"./SliderWithDropdownViewModel.js";import c from"../../support/Popover.js";import"../../support/widgetUtils.js";import{tsx as w}from"../../support/jsxFactory.js";const a={interactive:"esri-interactive",label:"esri-slider__label",box:"esri-slider-with-dropdown__box",dropdownRoot:"esri-slider-with-dropdown__dropdown-root",anchor:" esri-widget__anchor esri-slider-with-dropdown__anchor",anchorOpen:"esri-slider-with-dropdown__anchor--open",anchorClosed:"esri-slider-with-dropdown__anchor--closed",dropdownList:"esri-slider-with-dropdown__list",dropdownListItem:"esri-slider-with-dropdown__list-item",dropdownListItemSelected:"esri-slider-with-dropdown__list-item--selected",boxDropDownOn:"esri-slider-with-dropdown__box--drop-down-on",boxDropDownOff:"esri-slider-with-dropdown__box--drop-down-off"},h={selectItem:"Enter",closeDropdown:"Escape",moveSelectionUp:"ArrowUp",moveSelectionDown:"ArrowDown"};let m=class extends p{constructor(o,e){super(o,e),this.viewModel=new l,this.buttonTooltip="",this.showDropDown=!0,this._dropdownAnchor=null,this._dropdownElement=null,this._popover=new c({owner:this,placement:"bottom-start",anchorElement:()=>t(this._dropdownAnchor),renderContentFunction:()=>this._renderPopover()})}initialize(){this.addHandles(i((()=>this.viewModel.isDropdownOpen),(o=>{this._popover.open=o}),n))}destroy(){this._popover.destroy()}get items(){return this.viewModel.items}set items(o){this.viewModel.items=o}get currentIndex(){return this.viewModel.currentIndex}set currentIndex(o){this.viewModel.currentIndex=o}get currentItem(){return this.viewModel.currentItem}get isDropdownOpen(){return this.viewModel.isDropdownOpen}renderThumbLabel(o){const e={[a.boxDropDownOn]:this.showDropDown,[a.boxDropDownOff]:!this.showDropDown};return w("div",{class:this.classes(a.box,a.label,e)},super.renderThumbLabel(o),this.showDropDown&&w("div",{bind:this,afterCreate:this._onDropdownAnchorAfterCreate,class:a.dropdownRoot},w("button",{class:this.classes(a.interactive,a.anchor,this.isDropdownOpen?a.anchorOpen:a.anchorClosed),bind:this,disabled:this.disabled,onclick:this._onAnchorClick,onpointerdown:this._killEvent,"aria-label":this.buttonTooltip,title:this.buttonTooltip,"aria-expanded":this.isDropdownOpen.toString(),"aria-haspopup":"listbox",type:"button"},this.currentItem?this.currentItem.name+" ":"")))}_onDropdownAnchorAfterCreate(o){this._dropdownAnchor=o}_renderPopover(){return w("ol",{role:"listbox",afterCreate:this._onDropdownAfterCreate,"aria-label":this.buttonTooltip,bind:this,class:this.classes(a.dropdownList),tabindex:"-1",onkeydown:this._onDropdownKeyDown,onfocusout:this._onDropdownFocusOut,onpointerdown:this._killEvent},this.items.map(((o,e)=>w("li",{class:e===this.currentIndex?this.classes(a.interactive,a.dropdownListItem,a.dropdownListItemSelected):this.classes(a.interactive,a.dropdownListItem),bind:this,onclick:this._onDropdownItemClick,"data-result":e,"aria-label":o.label.join(" "),role:"option","aria-selected":(e===this.currentIndex).toString(),onkeydown:this._onLiKeyDown,tabindex:"0"},o.label.map((o=>w("span",{bind:this},o)))))))}_onDropdownAfterCreate(o){this._dropdownElement=o;const e=o.querySelector(`.${a.dropdownListItemSelected}`)??o.firstChild;r(e)&&e instanceof HTMLElement&&(e.scrollIntoView(),e.focus())}_onAnchorClick(){return!this.disabled&&(this.viewModel.toggle(),!0)}_onDropdownItemClick(o){const e=o.currentTarget;this.viewModel.selectItem(e["data-result"])}_onDropdownFocusOut(o){let e=o.relatedTarget;null===e&&(e=document.activeElement),r(this._dropdownElement)&&!this._dropdownElement.contains(e)&&r(this._dropdownAnchor)&&!this._dropdownAnchor.contains(e)&&(this.viewModel.isDropdownOpen=!1)}_killEvent(o){return o.stopPropagation(),!0}_onDropdownKeyDown(o){o.stopPropagation(),e(o)===h.closeDropdown&&(this.viewModel.isDropdownOpen=!1)}_onLiKeyDown(o){const t=o.target;switch(e(o)){case h.moveSelectionUp:if(t.previousElementSibling){t.previousElementSibling.focus()}break;case h.moveSelectionDown:if(t.nextElementSibling){t.nextElementSibling.focus()}break;case h.selectItem:t.click()}}};o([s()],m.prototype,"viewModel",void 0),o([s()],m.prototype,"buttonTooltip",void 0),o([s()],m.prototype,"showDropDown",void 0),o([s()],m.prototype,"items",null),o([s()],m.prototype,"currentIndex",null),o([s()],m.prototype,"currentItem",null),o([s()],m.prototype,"isDropdownOpen",null),m=o([d("esri.widgets.Daylight.SliderWithDropdown")],m);const u=m;export{u as default};
