/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import s from"../../Color.js";import{isNone as i}from"../../core/maybe.js";import{property as t}from"../../core/accessorSupport/decorators/property.js";import"../../core/arrayUtils.js";import{cast as r}from"../../core/accessorSupport/decorators/cast.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import o from"../../renderers/visualVariables/SizeVariable.js";import l from"../../renderers/visualVariables/support/SizeStop.js";import{SmartMappingSliderBase as n}from"./SmartMappingSliderBase.js";import d from"./SizeSlider/SizeSliderViewModel.js";import{getSizesFromVariable as p,getFillFromColor as m,getDynamicPathForSizeStops as u,getPathForSizeStops as c}from"./support/utils.js";import{storeNode as h}from"../support/widgetUtils.js";import{messageBundle as g}from"../support/decorators/messageBundle.js";import{tsx as z}from"../support/jsxFactory.js";var v;const b={base:"esri-size-slider",rampElement:"esri-size-slider__ramp",sliderContainer:"esri-size-slider__slider-container",histogramContainer:"esri-size-slider__histogram-container",zoomCapTop:"esri-size-slider__zoom-cap-top",zoomCapBottom:"esri-size-slider__zoom-cap-bottom",zoomCapLine:"esri-size-slider__zoom-cap-line",zoomCapMask:"esri-size-slider__zoom-cap-mask",zoomCapUnderline:"esri-size-slider__zoom-cap-underline",primaryHandle:"esri-size-slider--primary-handle",track:"esri-size-slider--interactive-track",esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},y={trackFillColor:new s([149,149,149]),trackBackgroundColor:new s([224,224,224])};let f=v=class extends n{constructor(e,s){super(e,s),this._maxRampFillWidth=1,this._minRampFillWidth=.2,this._rampNode=null,this.messages=null,this.style={...y},this.viewModel=new d}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get primaryHandleEnabled(){return this.viewModel.primaryHandleEnabled}set primaryHandleEnabled(e){this.viewModel.primaryHandleEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}castStyle(e){return{...y,...e}}static fromRendererResult(e,s){const{visualVariables:i,statistics:t}=e,{avg:r,stddev:a}=t,o=i[0],[l,n]=p(o),d=e.renderer.authoringInfo.visualVariables[0],m=d.minSliderValue,u=d.maxSliderValue;return new v({max:u,min:m,stops:[{value:o.minDataValue,size:n},{value:o.maxDataValue,size:l}],histogramConfig:{average:r,standardDeviation:a,bins:s?s.bins:[]}})}updateFromRendererResult(e,s){const{visualVariables:i,statistics:t}=e,{avg:r,stddev:a}=t,o=i[0],[l,n]=p(o),d=e.renderer.authoringInfo.visualVariables[0],m=d.minSliderValue,u=d.maxSliderValue;this.set({max:u,min:m,stops:[{value:o.minDataValue,size:n},{value:o.maxDataValue,size:l}],histogramConfig:{average:r,standardDeviation:a,bins:s?s.bins:[]}})}updateVisualVariable(e){const s=e.clone(),{stops:i}=this;if(!e||!i)return null;if(s.stops)return s.stops=i,s;const t=i[0],r=i[i.length-1];let a=s.maxSize,l=s.minSize;if(a instanceof o){const e=a.stops,s=r.size/e[0].size,i=e.map((e=>(e.size*=s,e)));a.stops=i}else a=r.size;if(l instanceof o){const e=l.stops,s=t.size/e[0].size,i=e.map((e=>(e.size*=s,e)));l.stops=i}else l=t.size;return s.set({maxDataValue:r.value,minDataValue:t.value,maxSize:a,minSize:l}),s}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:s,minDataValue:i,stops:t}=e;if(t)this.stops=t;else{const[t,r]=p(e);this.stops=[new l({value:i,size:r}),new l({value:s,size:t})]}}render(){const{label:e,primaryHandleEnabled:s,state:i,visibleElements:t}=this,r="disabled"===i,a=this.classes(b.base,b.esriWidget,b.esriWidgetPanel,{[b.disabled]:r,[b.primaryHandle]:s,[b.track]:t.interactiveTrack});return z("div",{"aria-label":e,class:a},r?null:this.renderContent(this.renderRamp(),b.sliderContainer,b.histogramContainer))}renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:s}=this;return z("div",{afterCreate:h,bind:this,class:b.rampElement,"data-node-ref":"_rampNode"},z("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},z("rect",{x:"0",y:"0",fill:m(e),height:"100%",width:"100%"}),this.renderPath()),s?this.renderZoomCaps():null)}renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:s=0}=this._rampNode;if(i(e)||i(s))return;const{primaryHandleEnabled:t,stops:r,style:{trackFillColor:a},values:o,viewModel:{max:l,min:n},_maxRampFillWidth:d,_minRampFillWidth:p}=this,h=[d,p];r[0].size<r[r.length-1].size&&h.reverse();const g=o.slice().sort(((e,s)=>e>s?1:-1)),[v,b]=h,[y,f]=g,S=t?u({max:l,min:n,pathHeight:e,pathWidth:s,stops:r,padding:b}):c({bottomValue:y,bottomWidth:v,max:l,min:n,pathHeight:e,pathWidth:s,topValue:f,topWidth:b});return z("path",{d:S,fill:m(a)})}};e([t()],f.prototype,"handlesSyncedToPrimary",null),e([t()],f.prototype,"label",null),e([t(),g("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],f.prototype,"messages",void 0),e([t()],f.prototype,"persistSizeRangeEnabled",null),e([t()],f.prototype,"primaryHandleEnabled",null),e([t()],f.prototype,"stops",null),e([t()],f.prototype,"style",void 0),e([r("style")],f.prototype,"castStyle",null),e([t()],f.prototype,"viewModel",void 0),f=v=e([a("esri.widgets.smartMapping.SizeSlider")],f);const S=f;export{S as default};
