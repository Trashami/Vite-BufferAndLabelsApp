/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import t from"../../../core/Evented.js";import{HandleOwnerMixin as o}from"../../../core/HandleOwner.js";import{isSome as i}from"../../../core/maybe.js";import{watch as r}from"../../../core/reactiveUtils.js";import{property as n}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/arrayUtils.js";import"../../../core/accessorSupport/ensureType.js";import{subclass as s}from"../../../core/accessorSupport/decorators/subclass.js";import d from"./support/ButtonMenu.js";import{renderingSanitizer as a}from"../../support/widgetUtils.js";const l={sortAscIcon:"esri-icon-arrow-up",sortDescIcon:"esri-icon-arrow-down",menuContainer:"esri-column__menu-container",menuIcon:"esri-icon-handle-horizontal",sorter:"esri-column__sorter",headerContent:"esri-column__header-content",headerLabel:"esri-column__header-label"},c={keyboardSort1:"Enter",keyboardSort2:"Spacebar"};let h=class extends(o(t.EventedAccessor)){constructor(e){super(e),this._menuContainer=document.createElement("div"),this.activeRowIndex=null,this.autoWidth=!1,this.cellValueFormatFunction=({value:e})=>a.sanitize(e),this.flexGrow=1,this.footerRenderFunction=null,this.frozen=!1,this.grid=null,this.header=null,this.headerRenderFunction=e=>{const{root:t}=e,{headerMenuEnabled:o,sortable:i}=this;if(this.removeCellContent(t),t.classList.add(l.headerContent),i)this.headerSorterRenderFunction(e);else{const{header:e,path:o}=this,i=document.createElement("div");i.classList.add(l.headerLabel),i.innerHTML=e??o??"",t.appendChild(i)}o&&this.headerMenuRenderFunction(e)},this.headerMenuRenderFunction=({root:e})=>{this.menu?.items?.length&&e.appendChild(this._menuContainer)},this.headerSorterRenderFunction=({root:e})=>{const{header:t,path:o,sortElement:i}=this,r=t??o??"";if(!i)return void(e.innerHTML=r);i.innerHTML!==r&&i.setAttribute("innerHTML",r),e.appendChild(i);const n=this.grid?.getSlotElementByName(e.slot),s=n?.parentElement;s&&!s.onkeydown&&(s.onkeydown=({key:e})=>{e!==c.keyboardSort1&&e!==c.keyboardSort2||i.click()})},this.hidden=!1,this.headerMenuEnabled=!0,this.initialSortPriority=null,this.menu=null,this.menuConfig=null,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.path=null,this.renderFunction=({root:e,column:t,rowData:o})=>{const i=this.getCellValue(t,o),r=this.cellValueFormatFunction({column:t,rowData:o,value:i});e.innerHTML!==r&&(e.innerHTML=r)},this.resizable=!0,this.sortable=!0,this.textAlign="start",this.width=200}initialize(){const{messages:e,path:t}=this;this._set("sortElement",this.createSortElement()),this.sortElement.setAttribute("path",t??""),this._menuContainer.classList.add(l.menuContainer),this.menu=new d({label:e?.options,iconClass:l.menuIcon,...this.menuConfig}),this.menu.container=this._menuContainer,this.menu.set("items",this.getMenuItems()),this.handles.add(r((()=>this.hidden),(()=>this.menu?.set("open",!1))),r((()=>this.path),(e=>{this.sortElement&&this.sortElement.path!==e&&this.sortElement.setAttribute("path",e??"")})))}destroy(){this.menu?.destroy()}set direction(e){this.sortable&&(this.sortElement&&(e?this.sortElement.direction!==e&&this.sortElement.setAttribute("direction",e):this.sortElement.removeAttribute("direction")),this._set("direction",e))}get direction(){return this._get("direction")||null}getMenuItems(){const{menuConfig:e,sortable:t}=this,o=e?.items,i=this.getSortMenuItems(),r=[];return t&&r.push(...i),o?.length&&r.push(...o),r.length?r:null}getSortMenuItems(){const{messages:e}=this;return[{selected:"asc"===this.direction,iconClass:l.sortAscIcon,label:e?.sortAsc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","asc"!==this.direction?"asc":null)},{selected:"desc"===this.direction,iconClass:l.sortDescIcon,label:e?.sortDesc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","desc"!==this.direction?"desc":null)}]}getCellValue(e,t){return t?.item[e?.path]??""}createSortElement(){const{direction:e,header:t,path:o,initialSortPriority:r}=this,n=t??o??"",s=document.createElement("vaadin-grid-sorter");return s.classList.add(l.sorter),s.setAttribute("path",o??""),s.setAttribute("title",n),s.innerHTML=n,e&&s.setAttribute("direction",e),i(r)&&(s._initialOrder=r),s.addEventListener("direction-changed",(()=>{this.direction!==s.direction&&this._set("direction",s.direction)})),s}removeCellContent(e){if(e)for(;e.firstChild;)try{e.removeChild(e.firstChild)}catch(t){}}};e([n()],h.prototype,"activeRowIndex",void 0),e([n()],h.prototype,"autoWidth",void 0),e([n()],h.prototype,"cellValueFormatFunction",void 0),e([n()],h.prototype,"direction",null),e([n()],h.prototype,"flexGrow",void 0),e([n()],h.prototype,"footerRenderFunction",void 0),e([n()],h.prototype,"frozen",void 0),e([n()],h.prototype,"grid",void 0),e([n()],h.prototype,"header",void 0),e([n()],h.prototype,"headerRenderFunction",void 0),e([n()],h.prototype,"headerMenuRenderFunction",void 0),e([n()],h.prototype,"headerSorterRenderFunction",void 0),e([n()],h.prototype,"hidden",void 0),e([n()],h.prototype,"headerMenuEnabled",void 0),e([n({constructOnly:!0})],h.prototype,"initialSortPriority",void 0),e([n()],h.prototype,"menu",void 0),e([n()],h.prototype,"menuConfig",void 0),e([n()],h.prototype,"messages",void 0),e([n()],h.prototype,"messagesCommon",void 0),e([n()],h.prototype,"messagesURIUtils",void 0),e([n()],h.prototype,"path",void 0),e([n()],h.prototype,"renderFunction",void 0),e([n()],h.prototype,"resizable",void 0),e([n()],h.prototype,"sortable",void 0),e([n({readOnly:!0})],h.prototype,"sortElement",void 0),e([n()],h.prototype,"textAlign",void 0),e([n()],h.prototype,"width",void 0),h=e([s("esri.widgets.FeatureTable.Grid.Column")],h);const u=h;export{u as default};
