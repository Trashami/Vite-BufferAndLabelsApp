/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import e from"../../config.js";import t from"../../core/Error.js";import has from"../../core/has.js";import r from"../../core/Logger.js";import o from"../../geometry/Point.js";import{geographicToWebMercator as i}from"../../geometry/support/webMercatorUtils.js";import s from"../../portal/Portal.js";import"../../request.js";import"../../kernel.js";import"../../core/arrayUtils.js";import"../../core/urlUtils.js";import"../../geometry.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/Multipoint.js";import"../../geometry/Polygon.js";import"../../geometry/Polyline.js";import"../../rest/geometryService/units.js";import"../../rest/operations/generalize.js";import"../../rest/support/GeneralizeParameters.js";import"../../rest/operations/lengths.js";import"../../rest/support/LengthsParameters.js";import"../../rest/operations/offset.js";import"../../rest/support/OffsetParameters.js";import{project as n}from"../../rest/geometryService/project.js";import"../../rest/operations/relation.js";import"../../rest/support/RelationParameters.js";import"../../rest/operations/trimExtend.js";import"../../rest/support/TrimExtendParameters.js";import m from"../../rest/support/ProjectParameters.js";const a=r.getLogger("esri.widgets.support.geolocationUtils"),c={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function u(){const e=has("esri-geolocation");return e||a.warn("geolocation-unsupported","Geolocation unsupported."),e}function p(){const e=window.isSecureContext;return e||a.warn("insecure-context","Geolocation requires a secure origin."),e}function l(){return u()&&p()}function g(e){const r=15e3;return e||(e=c),new Promise(((o,i)=>{setTimeout((()=>i(new t("geolocation:timeout","getting the current geolocation position timed out"))),r),navigator.geolocation.getCurrentPosition(o,i,e)}))}function j(e,t){const{position:r,view:o}=e;return y(d(f(r)),o,t)}function f(e){const t=e&&e.coords||{},r={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e?{coords:r,timestamp:e.timestamp}:e}function d(e){const t=e&&e.coords;return t?new o({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}}):null}function y(e,r,o){if(!r)return Promise.resolve(e);const s=r.spatialReference;return s.isWGS84?Promise.resolve(e):s.isWebMercator?Promise.resolve(i(e)):P(o).then((r=>{if(!r)throw new t("geometry-service:missing-url","Geometry service URL is missing");const i=new m({geometries:[e],outSpatialReference:s});return n(r,i,o).then((e=>e[0]))}))}function P(t){if(e.geometryServiceUrl)return Promise.resolve(e.geometryServiceUrl);const r=s.getDefault();return r.load(t).catch((()=>{})).then((()=>r.get("helperServices.geometry.url")))}export{g as getCurrentPosition,j as positionToPoint,l as supported};
