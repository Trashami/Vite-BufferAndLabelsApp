/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import"../geometry.js";import{p as e,c as r,e as n,a as t,r as o,l as s,b as i,d as a,f as u,s as l,g as c}from"../chunks/arcade.js";export{h as arcade}from"../chunks/arcade.js";import f from"../arcade/Dictionary.js";export{default as Dictionary}from"../arcade/Dictionary.js";import p from"../arcade/Feature.js";export{default as arcadeFeature}from"../arcade/Feature.js";import{m,x as y,k as d,c as v,a as x,b as g,w as j,T as w,U as b}from"../chunks/languageUtils.js";import{clone as E}from"../core/lang.js";import{isSizeVariable as F}from"../renderers/visualVariables/support/sizeVariableUtils.js";import S from"../geometry/Point.js";import $ from"../geometry/Polygon.js";import R from"../geometry/Polyline.js";import k from"../geometry/Multipoint.js";import z from"../geometry/Extent.js";const C=/^\$(feature|aggregatedFeatures)\./i,M={vars:{$feature:"any",$view:"any"},spatialReference:null};function P(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function I(e){return null==e?null:m(e)||y(e)?"array":d(e)?"date":v(e)?"text":x(e)?"boolean":g(e)?"number":e instanceof f?"dictionary":j(e)?"feature":e instanceof S?"point":e instanceof $?"polygon":e instanceof R?"polyline":e instanceof k?"multipoint":e instanceof z?"extent":w(e)?"featureSet":b(e)?"featureSetCollection":null}function A(r){if(!r)return null;try{return e(r)}catch(n){}return null}function D(e,n){const t="string"==typeof e?A(e):e;if(!t)return null;try{return n=n||E(M),r(t,n)}catch(o){}return null}function G(e,r){return{vars:{$feature:null==e?new p:p.createFromGraphic(e),$view:r&&r.view},spatialReference:r&&r.sr}}function T(e,r,n){return p.createFromGraphicLikeObject(r,e,n)}function U(e,r){null!=e.vars&&(e.vars.$feature=r)}function V(e,r){let t;try{t=n(e,r)}catch(o){t=null}return t}function L(e,r){let n;try{n=e?e(r):null}catch(t){n=null}return n}function q(e,r){try{return e?e(r):Promise.resolve(null)}catch(n){return Promise.resolve(null)}}function J(e,r){if(!e)return[];const n="string"==typeof e?A(e):e;if(!n)return[];const o=t(n);let s=new Array;o.forEach((e=>{C.test(e)&&(e=e.replace(C,""),s.push(e))}));const i=s.filter((e=>e.includes("*")));return s=s.filter((e=>!i.includes(e))),r&&i.forEach((e=>{const n=new RegExp(`^${e.split(/\*+/).map(P).join(".*")}$`,"i");r.forEach((e=>n.test(e)?s.push(e):null))})),[...new Set(s.sort())]}function O(e){return o(e,"$view")}function B(e,r){return!!e&&o(e,r)}function H(e){if(!e||null==e.spatialReference&&(null==e.scale||null==e.viewingMode))return;return{view:e.viewingMode&&null!=e.scale?new f({viewingMode:e.viewingMode,scale:e.scale}):null,sr:e.spatialReference}}function K({url:e,spatialReference:r,lrucache:n,interceptor:t}){const o=u();return o?o.createFeatureSetCollectionFromService(e,r,n,t):null}function N({layer:e,spatialReference:r,outFields:n,returnGeometry:t,lrucache:o,interceptor:s}){if(null===e)return null;const i=u();return i?i.constructFeatureSet(e,r,n,t??!0,o,s):null}function Q(e){if(null===e?.map)return null;const r=u();return r?r.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null}function W(e){return f.convertJsonToArcade(e)}function X(e,r,n=[]){return s(e,r,n)}function Y(){return i()}function Z(){return a()}function _(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type||"dot-density"===e.type||"dictionary"===e.type||"pie-chart"===e.type}function ee(e){return"esri.layers.support.LabelClass"===e.declaredClass}function re(e){return"esri.PopupTemplate"===e.declaredClass}function ne(e,r){if(!e)return!1;if("string"==typeof e)return r(e);const n=e;if(_(n)){if("dot-density"===n.type){const e=n.attributes?.some((e=>r(e.valueExpression)));if(e)return e}const e=n.visualVariables,t=!!e&&e.some((e=>{let n=r(e.valueExpression);return"size"===e.type&&(F(e.minSize)&&(n=n||r(e.minSize.valueExpression)),F(e.maxSize)&&(n=n||r(e.maxSize.valueExpression))),n}));return!(!("valueExpression"in n)||!r(n.valueExpression))||t}if(ee(n)){const e=n.labelExpressionInfo&&n.labelExpressionInfo.expression;return!(!e||!r(e))||!1}return!!re(n)&&(!!n.expressionInfos&&n.expressionInfos.some((e=>r(e.expression)))||Array.isArray(n.content)&&n.content.some((e=>"expression"===e.type&&r(e.expressionInfo?.expression))))}function te(e){const r=A(e);return!!r&&l(r)}function oe(e){return ne(e,te)}function se(e){const r=A(e);return!!r&&c(r)}function ie(e){return ne(e,se)}export{N as convertFeatureLayerToFeatureSet,W as convertJsonToArcade,Q as convertMapToFeatureSetCollection,K as convertServiceUrlToWorkspace,G as createExecContext,T as createFeature,D as createFunction,A as createSyntaxTree,O as dependsOnView,Z as enableFeatureSetOperations,Y as enableGeometryOperations,V as evalSyntaxTree,q as executeAsyncFunction,L as executeFunction,J as extractFieldNames,I as getArcadeType,H as getViewInfo,oe as hasGeometryFunctions,ie as hasGeometryOperations,B as hasVariable,X as loadScriptDependencies,U as updateExecContext};
