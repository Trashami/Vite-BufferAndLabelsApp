/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import t from"../Entity.js";import r from"../GraphObject.js";import n from"../ObjectValue.js";import o from"../Path.js";import s from"../Relationship.js";import{WasmGeometryTypeCodes as i}from"./KnowledgeWasmInterface.js";import{WasmGraphQueryResponseTypeCodes as a}from"./WasmQueryWrapperInterfaces.js";import{wasmToPolygonGeometry as l,wasmToPolylineGeometry as u,wasmToMultipointGeometry as p,wasmToPointGeometry as c}from"./wasmToGeometryFactories.js";const d=e.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors");function _(e,t){const r=[],n=e.count();for(let o=0;o<n;o++){const n=e.get_value_at(o);r.push(E(n,t))}return r}function E(e,t){if(null==e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case i.ESRI_GEOMETRY_POINT:return c(e);case i.ESRI_GEOMETRY_MULTIPOINT:return p(e);case i.ESRI_GEOMETRY_POLYLINE:return u(e);case i.ESRI_GEOMETRY_POLYGON:return l(e);case i.ESRI_GEOMETRY_ENVELOPE:case i.ESRI_GEOMETRY_MULTI_PATCH:return d.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected.  Result interpreted as null"),null;case i.ESRI_GEOMETRY_NULL:case i.ESRI_GEOMETRY_ANY:default:return d.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return d.warnOnce("A decoded value came back of a type that is not supported.  Result interpreted as null"),null;switch(e.object_value_type.value){case a.OBJECT:return g(e,t);case a.ENTITY:return f(e,t);case a.RELATIONSHIP:return O(e,t);case a.PATH:return I(e,t);case a.ARRAY:return _(e,t);default:return d.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}function f(e,r){const n=e.type_name,o=y(e,r),s=r.globalIdField&&o.properties?o.properties[r.globalIdField]:"";return new t(Object.assign({typeName:n,id:s},o))}function m(e,t){return new r(y(e,t))}function y(e,t){const r={},n=e.key_count();for(let o=0;o<n;o++)r[e.get_key_at(o)]=E(e.get_value_at(o),t);return{properties:r}}function g(e,t){return new n(y(e,t))}function I(e,t){const r=e.entity_count(),n=e.relationship_count(),s=[];for(let o=0;o<r;o++)s.push(f(e.get_entity_at(o),t)),o<n&&s.push(O(e.get_relationship_at(o),t));return new o({path:s})}function O(e,t){const r=e.type_name,n=y(e,t);return new s(Object.assign({typeName:r,id:t.globalIdField&&n.properties?n.properties[t.globalIdField]:"",originId:t.originEntityGlobalIdField&&n.properties?n.properties[t.originEntityGlobalIdField]:"",destinationId:t.destEntityGlobalIdField&&n.properties?n.properties[t.destEntityGlobalIdField]:""},n))}export{E as decodedWasmObjToQueryResponseObj,_ as wasmArrayToArray,f as wasmToEntity,m as wasmToGraphObject,g as wasmToObjectValue,I as wasmToPath,O as wasmToRelationship};
