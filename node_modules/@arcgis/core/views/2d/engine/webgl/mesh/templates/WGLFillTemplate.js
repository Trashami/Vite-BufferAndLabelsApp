/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{pt2px as t}from"../../../../../../core/screenUtils.js";import{premultiplyAlphaRGBAArray as e,premultiplyAlphaRGBA as i}from"../../color.js";import{BITSET_GENERIC_LOCK_COLOR as r,BITSET_FILL_RANDOM_PATTERN_OFFSET as o,BITSET_GENERIC_CONSIDER_ALPHA_ONLY as s,SPRITE_PADDING as l,MIN_MAX_ZOOM_PRECISION_FACTOR as a,PICTURE_FILL_COLOR as n}from"../../definitions.js";import{degToByte as m}from"../../GeometryUtils.js";import{i1616to32 as f,i8888to32 as c}from"../../number.js";import{FillMaterialKey as h}from"../../materialKey/MaterialKey.js";import{getMinMaxZoom as u,DEFAULT_MIN_ZOOM as d,DEFAULT_MAX_ZOOM as p}from"./util.js";import y from"./WGLBaseFillTemplate.js";import x from"./WGLMeshTemplate.js";const M=128;class j extends(y(x)){constructor(t,e,i,r,o,s,l,n,m,u,d,p,y,x,M,j){super(),this._effects=x;const w=h.load(t);e&&(w.sdf=e.sdf,w.pattern=!0,w.textureBinding=e.textureBinding),this.fillColor=i,this.tl=r,this.br=o,this.aux21=f(s,l),this.aux22=f(n,m),this.aux3=c(u,d,p,0),this._bitset=y,this._minMaxZoom=f(Math.round(M*a),Math.round(j*a)),this._materialKey=w.data}static fromCIMFill(e,a,n){const c=e.color,h=c&&i(c)||0,d=e.materialKey,[p,y]=u(e.scaleInfo,n),x=(e.colorLocked?r:0)|(e.applyRandomOffset?o:0)|(e.sampleAlphaOnly?s:0);if(!a)return new j(d,null,h,0,0,0,0,0,0,0,0,0,x,e.effects,p,y);const{rect:w,width:g,height:K}=a,_=e.scaleX||1,b=w.x+l,F=w.y+l,L=b+g,T=F+K,A=t(e.height),B=_*A;let G=Math.round(A);G<=0&&(G=T-F);let S=Math.round(B);S<=0&&(S=L-b);const C=t(e.offsetX||0),I=t(-e.offsetY||0),O=f(b,F),R=f(L,T);return new j(d,a,h,O,R,S,G,C,I,M,M,m(e.angle),x,e.effects,p,y)}static fromSimpleFill(t,i,o=!1){const{color:s}=t,a=s&&"esriSFSNull"!==t.style&&e(s)||0,n=o?r:0,m=t.materialKey;let c;if(i){const{rect:t,width:e,height:r,pixelRatio:o}=i,s=t.x+l,h=t.y+l,u=s+e,y=h+r,x=f(s,h),w=f(u,y);c=new j(m,i,a,x,w,e/o,r/o,0,0,M,M,0,n,null,d,p)}else c=new j(m,null,a,0,0,0,0,0,0,0,0,0,n,null,d,p);return c._maybeAddLineTemplate(t),c}static fromPictureFill(e,i,o=!1){const s=n,{rect:a,width:m,height:c}=i,h=a.x+l,u=a.y+l,y=h+m,x=u+c,w=f(h,u),g=f(y,x),K=Math.round(t(e.width)),_=Math.round(t(e.height)),b=t(e.xoffset),F=t(-e.yoffset),L=e.materialKey,T=o?r:0,A=new j(L,i,s,w,g,K,_,b,F,M*e.xscale,M*e.yscale,0,T,null,d,p);return A._maybeAddLineTemplate(e),A}}export{j as default};
