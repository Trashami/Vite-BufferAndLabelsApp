/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{isSome as t}from"../../../core/maybe.js";import{h as e,a as s}from"../../../chunks/vec2.js";import{a as n}from"../../../chunks/vec2f64.js";import{d as r,s as i}from"../../../chunks/vec3.js";import{f as o,c}from"../../../chunks/vec3f64.js";import{defaults as a}from"./Settings.js";import{objectEqual as h}from"./snappingUtils.js";import{pointToLineLikeDistance as u,projectPointToLineLike as l,projectPointToCircle as p,pointToVerticalPlaneDistance as d,projectPointToVerticalPlane as f,VerticalPlaneType as Z,epsilon as X,intersectLineAndPoint as Y,intersectCircleAndPoint as k,intersectVerticalPlaneAndPoint as m,intersectLineLike as L,intersectLineLikeAndCircle as H,intersectVerticalPlaneAndLineLike as T,intersectVerticalPlaneAndCircle as y,intersectVerticalPlane as g}from"../../support/geometry3dUtils.js";import{LineType as q}from"../../support/geometry2dUtils.js";class x{constructor(t){this.coordinateHelper=t}intersect(t){return w(this,t)}}class j extends x{constructor(t,e){super(t),this.point=e,this.pointXYZ=t.toXYZ(e)}equals(t){return _(t)&&h(this.point,t.point)}check(t){const e=this.coordinateHelper.toXYZ(t,D);return r(e,this.pointXYZ)<a.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}}class O extends x{constructor(t,e,s,n){super(t),this.start=e,this.end=s,this.type=n,this.startXYZ=t.toXYZ(e),this.endXYZ=t.toXYZ(s),this.lineLike={start:this.startXYZ,end:this.endXYZ,type:this.type}}equals(t){return S(t)&&this.type===t.type&&h(this.start,t.start)&&h(this.end,t.end)}check(t){const e=this.coordinateHelper.toXYZ(t,D);return u(this.lineLike,e)<a.pointOnLineThreshold}closestTo(t){const e=this.coordinateHelper,s=e.toXYZ(t,D),n=l(s,this.lineLike);return e.fromXYZ(n)}}class A extends O{constructor(t,e,s){super(t,e,s,q.LINE)}}class E extends x{constructor(t,e,s,n){super(t),this.intersection=e,this.first=s,this.second=n}equals(t){return t instanceof E&&this.first.equals(t.first)&&this.second.equals(t.second)}check(){return!1}closestTo(){return this.coordinateHelper.clone(this.intersection)}}class I extends x{constructor(t,e,s,n){super(t),this.basePoint=e,this.first=s,this.second=n}equals(t){return t instanceof I&&this.first.equals(t.first)&&this.second.equals(t.second)}check(){return!1}closestTo(t){const e=this.basePoint,s=this.coordinateHelper,n=s.toXYZ(t,D),r=i(J,e[0],e[1],n[2]);return s.fromXYZ(r)}}class P extends x{constructor(t,e,s){super(t),this.center=e,this.radius=s,this.centerXYZ=t.toXYZ(e)}equals(t){return z(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}check(){return!1}closestTo(t){const e=this.coordinateHelper,s=e.toXYZ(t,D),n=p(s,this.centerXYZ,this.radius);return n[2]=e.getZ(t,this.centerXYZ[2]),e.fromXYZ(n)}}class b extends x{constructor(t,e,s,n){super(t),this.start=e,this.end=s,this.type=n,this.planeLike={start:e,end:s,type:n}}equals(t){return B(t)&&this.type===t.type&&h(this.start,t.start)&&h(this.end,t.end)}check(t){const e=this.coordinateHelper.toXYZ(t,D);return d(e,this.planeLike)<a.pointOnLineThreshold}closestTo(t){const e=this.coordinateHelper,s=e.toXYZ(t,D),n=f(s,this.planeLike);return e.fromXYZ(n)}closestEndTo(t){const{start:n,end:r}=this;return Math.sign(e(s(K,r,n),s(Q,t,n)))>0?r:n}}class v extends b{constructor(t,e,s){super(t,e,s,Z.HALF_PLANE)}}class G extends b{constructor(t,e,s){super(t,e,s,Z.PLANE)}}class N extends x{constructor(t,e,s,n){super(t),this.start=e,this.end=s,this.getZ=n,this.planeLike={start:e,end:s,type:Z.HALF_PLANE}}equals(t){return C(t)&&h(this.start,t.start)&&h(this.end,t.end)&&this.getZ===t.getZ}check(t){const e=this.coordinateHelper.toXYZ(t,D),s=U(this,e);return r(e,s)<a.pointThreshold}closestTo(t){const e=this.coordinateHelper,s=U(this,e.toXYZ(t,D));return e.fromXYZ(s)}addIfOnTheGround(e,s){for(const n of s){const s=this.getZ(n[0],n[1],n[2]);t(s)&&Math.abs(n[2]-s)<X&&(n[2]=s,e.push(n))}}}function U(e,s){const n=f(s,e.planeLike),r=e.getZ(s[0],s[1],s[2]);return t(r)&&(n[2]=r),n}function w(t,e){let s=[];if(_(t)){const{pointXYZ:n}=t;S(e)?s=Y(e.lineLike,n):z(e)?s=k(e.centerXYZ,e.radius,n):B(e)?s=m(e.planeLike,n):C(e)&&(s=F(e,t))}else if(S(t)){const{lineLike:n}=t;_(e)?s=Y(n,e.pointXYZ):S(e)?s=L(n,e.lineLike):z(e)?s=H(n,e.centerXYZ,e.radius):B(e)?s=T(e.planeLike,n):C(e)&&(s=F(e,t))}else if(z(t)){const{centerXYZ:n,radius:r}=t;S(e)?s=H(e.lineLike,n,r):_(e)?s=k(n,r,e.pointXYZ):B(e)?s=y(e.planeLike,n,r):C(e)&&(s=F(e,t))}else if(B(t)){const{planeLike:n,coordinateHelper:r}=t;if(B(e))return g(n,e.planeLike).map((s=>new I(r,r.fromXYZ(s),t,e)));_(e)?s=m(n,e.pointXYZ):S(e)?s=T(n,e.lineLike):z(e)?s=y(n,e.centerXYZ,e.radius):C(e)&&(s=F(e,t))}else C(t)&&(s=F(t,e));return M(s,t,e)}function F(e,s){const{planeLike:n,getZ:r}=e,i=[];if(_(s))e.addIfOnTheGround(i,m(n,s.pointXYZ));else if(S(s))e.addIfOnTheGround(i,T(n,s.lineLike));else if(z(s))e.addIfOnTheGround(i,y(n,s.centerXYZ,s.radius));else if(B(s)||C(s))for(const[c,a]of g(n,s.planeLike)){const e=r(c,a,0);t(e)&&i.push(o(c,a,e))}return i}function M(t,e,s){const n=e.coordinateHelper;return t.map((t=>new E(n,n.fromXYZ(t),e,s)))}function _(t){return t instanceof j}function S(t){return t instanceof O}function z(t){return t instanceof P}function B(t){return t instanceof b}function C(t){return t instanceof N}const D=c(),J=c(),K=n(),Q=n();export{N as DrapedLineConstraint,E as IntersectionConstraint,A as LineConstraint,O as LineLikeConstraint,P as PlanarCircleConstraint,j as PointConstraint,x as SnappingConstraint,v as VerticalHalfPlaneConstraint,I as VerticalLineIntersectionConstraint,G as VerticalPlaneConstraint,b as VerticalPlaneLikeConstraint};
