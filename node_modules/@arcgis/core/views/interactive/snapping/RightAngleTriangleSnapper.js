/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{unwrap as e}from"../../../core/maybe.js";import{l as t,d as o}from"../../../chunks/vec2.js";import{a as r}from"../../../chunks/vec2f64.js";import{absoluteHeightElevationInfo as s}from"../../../support/elevationInfoUtils.js";import{SnappingAlgorithm as i}from"./SnappingAlgorithm.js";import{convertPointElevation as n,squaredScreenDistance as p}from"./snappingUtils.js";import{RightAngleTriangleSnappingCandidate as a}from"./candidates/RightAngleTriangleSnappingCandidate.js";import{anyMapPointToScreenPoint as d}from"../support/viewUtils.js";import{projectPointToCircle as l}from"../../support/geometry2dUtils.js";class m extends i{snapNewVertex(e,t){const o=t.editGeometryOperations.data.components[0],r=[],s=o.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||s<2)return r;const{view:i}=this,p=o.vertices[0],a=o.vertices[s-1],d=n(p.pos,i,t),l=n(a.pos,i,t);return this._processCandidateProposal(d,l,e,t,r),r}snapExistingVertex(t,o){const r=[],s=e(o.vertexHandle),i=s.component;if(i.edges.length<2)return r;if("polyline"===o.editGeometryOperations.data.type&&(0===s.index||s.index===i.vertices.length-1))return r;const{view:p}=this,a=n(s.leftEdge.leftVertex.pos,p,o),d=n(s.rightEdge.rightVertex.pos,p,o);return this._processCandidateProposal(a,d,t,o,r),r}_processCandidateProposal(e,r,i,n,m){if(!this.exceedsShortLineThreshold(e,r,n))return;const g=t(c,e,r,.5),f=.5*o(e,r),u=l(h,i,g,f),{coordinateHelper:v,pointer:x}=n,y=v.fromXYZ(u,v.getZ(i,0)),j=d(i,v,s,this.view);p(j,d(y,v,s,this.view))<this.squaredProximityThreshold(x)&&m.push(new a({coordinateHelper:v,targetPoint:y,point1:e,point2:r,elevationInfo:v.hasZ()?s:null}))}}const c=r(),h=r();export{m as RightAngleTriangleSnapper};
