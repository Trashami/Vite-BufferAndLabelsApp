/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import o from"../../../../Color.js";import r from"../../../../core/Logger.js";import{get as t,mapOr as e,isSome as i}from"../../../../core/maybe.js";import{pt2px as n}from"../../../../core/screenUtils.js";import{Z as l}from"../../../../chunks/vec4f64.js";class s{constructor(o){this.definition=o,this.key=JSON.stringify(o),this.haloSize=Math.round(o.halo.size),this.textStyle=this._colorToRGBA(o.color),this.haloStyle=this._colorToRGB(o.halo.color),this.backgroundStyle=0!==o.background.color[3]?this._colorToRGBA(o.background.color):null}fontString(o){const r=this.definition.font;return`${r.style} ${r.weight} ${o}px ${r.family}, sans-serif`}_colorToRGB(o){return`rgb(${o.slice(0,3).map((o=>Math.floor(255*o))).toString()})`}_colorToRGBA(o){return`rgba(${o.slice(0,3).map((o=>Math.floor(255*o))).toString()},${o[3]})`}static async fromSymbol(a,c=1){const g=t(a,"material","color"),f=e(g,l,o.toUnitRGBA),d=e(a.size,12,n),h=a.lineHeight,m=i(a.background)?o.toUnitRGBA(a.background.color):l,u={family:e(a.font,"sans-serif",(o=>o.family)),decoration:e(a.font,"none",(o=>o.decoration)),weight:e(a.font,"normal",(o=>o.weight)),style:e(a.font,"normal",(o=>o.style))},b=a.halo,y=i(b)&&i(b.color)&&b.size>0?{size:n(b.size),color:o.toUnitRGBA(b.color)}:{size:0,color:l},p=new s({color:f,size:d,background:{color:m,padding:i(a.background)?[.65*d,.5*d]:[0,0],borderRadius:i(a.background)?d*(6/16):0},lineSpacingFactor:h,font:u,halo:y,pixelRatio:c}),S=p.fontString(d);try{await document.fonts.load(S)}catch(R){r.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${S}'. Some text symbology may be rendered using the default browser font.`)}return p}}export{s as TextRenderParameters};
