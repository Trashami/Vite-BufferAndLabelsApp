/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{Z as o}from"../../../../../../chunks/vec3f64.js";import{LayerBlendMode as r}from"../output/BlendOptions.js";import{BackgroundGrid as e}from"./BackgroundGrid.glsl.js";import{BlendModes as t}from"../util/BlendModes.glsl.js";import{texelFetch as a}from"../util/WebGL2Utils.js";import{Float3PassUniform as s}from"../../shaderModules/Float3PassUniform.js";import{FloatPassUniform as i}from"../../shaderModules/FloatPassUniform.js";import{NoParameters as l,glsl as n}from"../../shaderModules/interfaces.js";import{createTexture2DPassSizeUniforms as p}from"../../shaderModules/Texture2DPassUniform.js";import{TextureSizeUniformType as u}from"../../shaderModules/TextureSizeUniformType.js";var c,d,m;!function(o){o[o.Composite=0]="Composite",o[o.ColorComposite=1]="ColorComposite",o[o.GridComposite=2]="GridComposite",o[o.GroupBackgroundComposite=3]="GroupBackgroundComposite",o[o.COUNT=4]="COUNT"}(c||(c={})),function(o){o[o.NotRequired=0]="NotRequired",o[o.Required=1]="Required",o[o.COUNT=2]="COUNT"}(d||(d={})),function(o){o[o.Off=0]="Off",o[o.On=1]="On",o[o.COUNT=2]="COUNT"}(m||(m={}));class C extends l{constructor(){super(...arguments),this.baseOpacity=1,this.backgroundColor=o,this.fboTexture=null}}function f(o,l){const C=l.output===c.GridComposite,f=l.output===c.ColorComposite,g=l.output===c.GroupBackgroundComposite,b=l.output===c.Composite;C&&(o.extensions.add("GL_OES_standard_derivatives"),o.fragment.include(e)),f&&o.fragment.uniforms.add(new s("backgroundColor",(o=>o.backgroundColor)));const y=l.baseOpacityMode===d.Required;if(y&&o.fragment.uniforms.add(new i("baseOpacity",(o=>o.baseOpacity))),b){const r=l.hasWebGL2Context?u.None:u.InvSize;o.fragment.uniforms.add(p("fboColor",(o=>o.fboTexture),r))}const v=l.blendMode!==r.Normal,O=l.premultipliedSource===m.On;o.fragment.include(t,l),o.fragment.code.add(n`
    vec4 getBackground(vec2 uv) {
      return ${y?n`baseOpacity *`:""} ${g?n`vec4(0.0, 0.0, 0.0, 0.0)`:f?n`vec4(backgroundColor, 1.0)`:C?n`gridColor(uv)`:n`${a(l,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${v?n`
          vec3 Cb = bgColor.a == 0.0 ? bgColor.rgb : vec3(bgColor.rgb * bgColor.a);
          return applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, bgColor.a);`:n`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          return ${O?n`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:b&&!y||g?n`pmColorLayer * composeAlpha;`:n`mix(bgColor, pmColorLayer, composeAlpha);`}`}
    }`)}export{d as BaseOpacityMode,c as BlendLayersOutput,m as PremultipliedAlphaSource,f as TileBackground,C as TileBackgroundPassParameters};
