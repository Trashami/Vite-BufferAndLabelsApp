/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import r from"../../../../core/Error.js";import{isSome as t}from"../../../../core/maybe.js";import"../../../../core/Logger.js";import"../../../../core/accessorSupport/ensureType.js";import"../../../../core/arrayUtils.js";import"../../../../core/has.js";import{subclass as s}from"../../../../core/accessorSupport/decorators/subclass.js";import{unpackFieldNames as o,populateMissingFields as a}from"../../../../layers/support/fieldUtils.js";import{getFetchPopupTemplate as p,getRequiredFields as i}from"../../../layers/support/popupUtils.js";const c=c=>{let u=class extends c{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:s}=t;if(!s)return new r("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t});return p(t,e)?void 0:new r("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,r){const s=this._validateFetchPopupFeatures(r);if(s)throw s;const c=t(r)?r.clientGraphics:null;if(!c||0===c.length)return[];const u="scene"===this.layer.type&&t(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,n=o(this.layer.fieldsIndex,await i(u,p(this.layer,r)));await this.prepareFetchPopupFeatures(n);const l=new Set,h=[],y=[];for(const t of c)a(n,t,l)?y.push(t):h.push(t);return 0===y.length?h:this.whenGraphicAttributes(y,[...l]).catch((()=>y)).then((e=>h.concat(e)))}};return u=e([s("esri.views.3d.layers.support.PopupSceneLayerView")],u),u};export{c as PopupSceneLayerView};
