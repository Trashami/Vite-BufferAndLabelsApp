/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{width as t,height as e,intersects as n}from"../../../../geometry/support/aaBoundingRect.js";import{Geometry as i}from"../../webgl-engine/lib/Geometry.js";import{createSquareGeometry as r}from"../../webgl-engine/lib/GeometryUtil.js";import{VertexAttribute as o}from"../../webgl-engine/lib/VertexAttribute.js";function a(n,i,r){const o=t(n)/e(n),a={width:r,height:r};return o>1.0001?a.height=r/o:o<.9999&&(a.width=r*o),a.width=Math.round(a.width/(t(n)/t(i))),a.height=Math.round(a.height/(e(n)/e(i))),a}function h(t){return r([[t[0],t[1],-1],[t[2],t[1],-1],[t[2],t[3],-1],[t[0],t[3],-1]])}function l(t,e){if(!n(t,e))return h(e);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],a=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],l=e[2]-e[0],u=e[3]-e[1],m=a[0]>0&&a[2]>0?3:2,c=r[0]>0&&r[2]>0?3:2,g=(c+1)*(m+1),w=new Float64Array(3*g),f=new Float32Array(2*g),d=new Array(6*(c*m-1));let M=0,b=0,p=0,x=0,y=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=a[r];t<=0||(w[b++]=e[0]+i,w[b++]=e[1]+M,w[b++]=-1,f[p++]=i/l,f[p++]=M/u,r<3&&n<3&&(1!==r||1!==n)&&(d[y++]=x,d[y++]=x+1,d[y++]=x+m+1,d[y++]=x+1,d[y++]=x+m+2,d[y++]=x+m+1),x++,i+=t)}M+=t}const A=new Array(d.length);return new i([[o.POSITION,{size:3,data:w,exclusive:!0}],[o.NORMAL,{size:3,data:s,exclusive:!0}],[o.UV0,{size:2,data:f,exclusive:!0}]],[[o.POSITION,d],[o.NORMAL,A],[o.UV0,d]])}const s=[0,0,1];export{a as computeImageExportSize,h as createGeometryForExtent,l as createOuterImageGeometry};
