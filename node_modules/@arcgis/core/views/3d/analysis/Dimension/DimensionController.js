/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import{LengthDimensionMeasureType as t}from"../../../../analysis/dimensionUtils.js";import s from"../../../../core/Accessor.js";import o from"../../../../core/Handles.js";import r from"../../../../core/Logger.js";import{destroyMaybe as i}from"../../../../core/maybe.js";import{watch as n,syncAndInitial as a}from"../../../../core/reactiveUtils.js";import{getDefaultUnitForView as l,convertUnit as m}from"../../../../core/unitUtils.js";import{property as d}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/arrayUtils.js";import"../../../../core/accessorSupport/ensureType.js";import{subclass as c}from"../../../../core/accessorSupport/decorators/subclass.js";import{isGeodesicDimension as p,GEODESIC_DISTANCE_THRESHOLD as h,computeGeometryFromDimension as u,computeLength as y,computationToGeometryDependencies as f}from"./lengthDimensionUtils.js";let g=class extends s{constructor(e){super(e),this._handles=new o}initialize(){const{computations:e}=this.analysisViewData;for(const t of e)this._addComputation(t);this.addHandles(e.on("change",(({added:e,removed:t})=>{for(const s of t)this._removeComputation(s);for(const s of e)this._addComputation(s)})))}destroy(){this._handles=i(this._handles)}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return l(this.view)}_addComputation(e){this._handles.has(e)||this._handles.add(n((()=>f(e)),(s=>{const{measureType:o}=s;if(p(s)&&o!==t.Direct){const t=Math.round(m(h,"meters","kilometers"));return r.getLogger(this.declaredClass).warnOnce(`A ${o} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${t} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const i=u(s,this.view.renderCoordsHelper,e.geometry);e.geometry=i,e.result.length=y(i,o,this._defaultUnit)}),a),e)}_removeComputation(e){this._handles.remove(e)}};e([d({constructOnly:!0})],g.prototype,"analysisViewData",void 0),e([d({constructOnly:!0})],g.prototype,"view",void 0),e([d()],g.prototype,"analysis",null),e([d()],g.prototype,"_defaultUnit",null),g=e([c("esri.views.3d.analysis.Dimension.support.DimensionController")],g);export{g as DimensionController};
