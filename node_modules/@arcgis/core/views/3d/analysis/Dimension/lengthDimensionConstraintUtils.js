/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{LengthDimensionMeasureType as t}from"../../../../analysis/dimensionUtils.js";import"../../../../core/has.js";import{isNone as e,isSome as n}from"../../../../core/maybe.js";import{k as i,g as o,e as r,b as s,p as a}from"../../../../chunks/vec3.js";import{sv3d as c}from"../../../../geometry/support/vectorStacks.js";import{automaticHeadingFromCamera as m}from"./lengthDimensionManipulatorUtils.js";import{isGeodesicDimension as l,directUp as d,directStartToEnd as p}from"./lengthDimensionUtils.js";import{settings as P}from"./settings.js";var u;function f(t,n){if(l(t))return u.Direct;const{geometry:m}=t;if(e(m)||i(m.directSegment.startRenderSpace,m.directSegment.endRenderSpace))return null;const{constraintThresholdPx:f}=P,{camera:g}=n.state,y=d(c.get(),m,n.renderCoordsHelper),S=p(c.get(),m),z=o(c.get(),y,r(S,y)),x=s(c.get(),S,z),h=a(x),j=a(z),{startRenderSpace:v,endRenderSpace:D}=m.directSegment,R=Math.max(g.computeRenderPixelSizeAt(v)*f,g.computeRenderPixelSizeAt(D)*f)**2;return h<R?u.Vertical:j<R?u.Horizontal:null}function g(i,o,r){const{constraint:s,elevationAlignedStartPoint:a,elevationAlignedEndPoint:c,unconstrainedGeometry:l,view:d}=r,{dimension:p,previousConstraint:P,preConstraintProperties:f}=i;if(e(a)||e(c))return;const g=()=>{"startPoint"in o?p.startPoint=o.startPoint:"endPoint"in o&&(p.endPoint=o.endPoint)};if(e(s))g(),n(P)&&n(f)&&(p.measureType=f.measureType,p.orientation=f.orientation);else switch(p.measureType=t.Direct,s){case u.Horizontal:if(s!==P&&(p.orientation=0),"startPoint"in o){const t=o.startPoint;n(t)&&(t.z=c.z),p.startPoint=t}else if("endPoint"in o){const t=o.endPoint;n(t)&&(t.z=a.z),p.endPoint=t}break;case u.Vertical:if(s!==P&&(p.orientation=m(l,d)),"startPoint"in o){const t=o.startPoint;n(t)&&(t.x=c.x,t.y=c.y),p.startPoint=t}else if("endPoint"in o){const t=o.endPoint;n(t)&&(t.x=a.x,t.y=a.y),p.endPoint=t}break;case u.Direct:s!==P&&n(f)&&(p.orientation=f.orientation),g()}i.previousConstraint=s}!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Direct=2]="Direct"}(u||(u={}));export{u as LengthDimensionConstraint,g as applyConstraint,f as computeConstraint};
