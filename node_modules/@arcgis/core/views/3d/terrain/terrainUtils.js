/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import t from"../../../core/Collection.js";import{isSome as n}from"../../../core/maybe.js";import{isCGCS2000 as e,isEarth as r}from"../../../geometry/support/spatialReferenceUtils.js";import{getTileMaxtrixSetFromActiveLayer as o}from"../../../layers/support/layerUtils.js";import{ViewingMode as i}from"../../ViewingMode.js";import{ImageWithType as l}from"../support/StreamDataLoader.js";import{NeighborIndex as u}from"./interfaces.js";import{t as f}from"../../../chunks/terrainUtilsPlanar.js";import{t as c}from"../../../chunks/terrainUtilsSpherical.js";const a={[i.Global]:c,[i.Local]:f};function T(t,n){t||console.warn("Terrain: "+n)}let s=!1,S=!1;function E(t){S=t,s=s||t}function p(t){s=t}function m(t,n){if(s&&!t){const t=(new Error).stack.slice(5);throw console.warn("Terrain internal: "+(n||"")+" at "+t),new Error("Assertion failed"+(n?": "+n:""))}}function H(t){return y(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function O(t){return"imagery-tile"===t?.type||"wcs"===t?.type}function y(t){return"imagery-tile-3d"===t?.type}function _(t){return"tile-3d"===t?.type}function I(t){return"vector-tile-3d"===t?.type}function R(t){return"wmts-3d"===t?.type}function U(t){return"elevation-3d"===t?.type}function W(t){return"group"===t?.type}function N(t){return"group"===t?.type}function d(t){return t&&(_(t)||R(t)||y(t)||I(t))}function x(t){return t&&(_(t)||y(t)||I(t)||R(t))}function A(t){return x(t)||U(t)}function g(t){const e=t?.sourceLayerInfo?.data;return n(e)&&"type"in e&&"raster-tile"===e.type}function h(t){const e=t?.sourceLayerInfo?.data;return n(e)&&"type"in e&&"vector-tile"===e.type}function L(t){const e=t?.sourceLayerInfo?.data;return n(e)&&"type"in e&&"tile-texture"===e.type}function w(t){const n=t?.sourceLayerInfo?.data;return n instanceof HTMLImageElement||n instanceof l||n instanceof HTMLCanvasElement||n instanceof ImageData}function j(t){return n(t)&&"release"in t&&t.release(),null}function C(t){return t.fetchTile&&!1!==t.hasOverriddenFetchTile}function b(t,n,e,r){return a[r].checkIfTileInfoSupportedForViewSR(t,e,n)}function v(t,e,r){let o=null,l=null;if("wmts"===t?.type){const n=M(t,e,r);o=n.tileInfo,l=n.fullExtent}else{l=O(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=r===i.Local;if(O(t))o=t.getCompatibleTileInfo(e,l,n);else if("vector-tile"===t?.type){const r=n&&!k(e)||V.force512VTL,i=t.tileInfo.spatialReference.isGeographic;o=r?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,i?1:2)}else o=t.tileInfo}return n(o)&&n(l)&&null==b(o,l,e,r)?{tileInfo:o,fullExtent:l}:null}function M(e,r,i){const l=o(e);if(n(l)){if(!t.isCollection(l))return{tileInfo:l.tileInfo,fullExtent:l.fullExtent};{const t=l.find((t=>null==b(t.tileInfo,t.fullExtent,r,i)));if(t)return{tileInfo:t.tileInfo,fullExtent:t.fullExtent}}}return{tileInfo:null,fullExtent:null}}function k(t){return t.isWGS84||t.isWebMercator||e(t)||!r(t)}const V={force512VTL:!1};function F(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function G(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function D(t,n,e=$){return Math.abs(t-n)<e}function P(t){return t===u.NORTH_EAST?u.SOUTH_WEST:t===u.NORTH_WEST?u.SOUTH_EAST:t===u.SOUTH_WEST?u.NORTH_EAST:u.NORTH_WEST}function q(t){return t===u.NORTH?u.SOUTH:t===u.EAST?u.WEST:t===u.SOUTH?u.NORTH:u.EAST}function z(t){return t===u.NORTH_WEST||t===u.SOUTH_WEST}function B(t){return t===u.NORTH_WEST||t===u.NORTH_EAST}function J(t){return t===u.NORTH_WEST||t===u.WEST||t===u.SOUTH_WEST}function K(t){return t===u.NORTH_EAST||t===u.EAST||t===u.SOUTH_EAST}function Q(t){return t===u.SOUTH_EAST||t===u.SOUTH||t===u.SOUTH_WEST}function X(t){return t===u.NORTH_EAST||t===u.NORTH||t===u.NORTH_WEST}const Y=[u.NORTH,u.EAST,u.SOUTH,u.WEST],Z=[u.NORTH_EAST,u.SOUTH_EAST,u.SOUTH_WEST,u.NORTH_WEST],$=1e-5;export{s as ENABLE_TERRAIN_INTERNAL_CHECKS,S as ENABLE_WATERPROOFNESS_TESTS,D as almostEquals,b as checkIfTileInfoSupportedForView,p as enableTerrainInternalChecks,E as enableTerrainWaterproofnessChecks,$ as eps,H as getLayerWithExtentRange,M as getTileInfoAndExtentFromWMTSLayer,v as getTiledLayerInfo,m as internalAssert,d as isBlendableLayerView,K as isEast,U as isElevationLayerView,N as isGroupLayer,W as isGroupLayerView,y as isImageryTileLayerView,g as isImageryTileRenderInfo,x as isMapTileLayerView,X as isNorth,B as isNorthCorner,O as isProjectableRasterLayer,w as isRasterTileRenderInfo,Q as isSouth,A as isSurfaceLayerView,L as isTextureTileRenderInfo,_ as isTileLayerView,I as isVectorTileLayerView,h as isVectorTileRenderInfo,R as isWMTSLayerView,J as isWest,z as isWestCorner,F as lij2s,Z as neighborCornerIndices,Y as neighborEdgeIndices,P as oppositeCorner,q as oppositeEdge,j as releaseTileData,V as test,C as useFetchTileForLayer,G as v32s,k as vtlAssumes256PixelSizeAsDefault,T as weakAssert};
