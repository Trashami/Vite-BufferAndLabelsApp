/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{isSome as t}from"../../../../../core/maybe.js";import{getZForElevationMode as e}from"../../../../../support/elevationInfoUtils.js";import{EventPipeline as n}from"../../../../interactive/dragEventPipeline.js";class a{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this.next=new n,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&t(this._lastDragEvent)){const n=this._lastDragEvent.mapEnd,a=this._snap(this._lastDragEvent.screenEnd);if(t(a)){const t={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?a:n,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this.next.execute(t)}}this._enabled=e}_snap(n){const a=t(this._view)?this._view.toMap(n,{exclude:[]}):null;return t(a)&&t(this._view)&&(a.z=e(a,this._view,this._elevationInfo)),a}createDragEventPipelineStep(e,n){return this._view=e,this._elevationInfo=n,this._lastDragEvent=null,e=>{if(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const n=this._snap(e.screenEnd);return t(n)?{action:e.action,mapStart:e.mapStart,mapEnd:n,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}export{a as SnapToScene};
