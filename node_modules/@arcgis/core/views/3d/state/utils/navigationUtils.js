/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{cyclicalPI as t}from"../../../../core/Cyclical.js";import{deg2rad as e,clamp as n,acosClamped as o,asinClamped as r}from"../../../../core/mathUtils.js";import{isNone as a}from"../../../../core/maybe.js";import{createScreenPointArray as i}from"../../../../core/screenUtils.js";import{d as s,j as c,m,e as l}from"../../../../chunks/mat4.js";import{I as u,c as p}from"../../../../chunks/mat4f64.js";import{s as f}from"../../../../chunks/vec2.js";import{a as h}from"../../../../chunks/vec2f64.js";import{b as M,m as y,a as g,l as d,g as b,h as j,s as v,n as z,e as x,d as P,c as I,f as k}from"../../../../chunks/vec3.js";import{c as w}from"../../../../chunks/vec3f64.js";import{create as E,axis as S,fromPoints as A,wrapAxisAngle as H}from"../../../../geometry/support/axisAngle.js";import{coordinateSystemFromOneAxisAndNormalVector as G,vectorCoordinates as U}from"../../../../geometry/support/coordinateSystem.js";import{create as V,intersectRay as q,fromNormalAndOffset as C}from"../../../../geometry/support/plane.js";import{b as F,i as R,c as T}from"../../../../chunks/sphere.js";import{angle as W}from"../../../../geometry/support/vector.js";import{sm4d as B,sv3d as D}from"../../../../geometry/support/vectorStacks.js";import{fromScreen as J,fromScreenAtEye as K}from"../../support/geometryUtils/ray.js";import{intersectScreen as L}from"../../support/geometryUtils/sphere.js";import{Camera as N}from"../../webgl-engine/lib/Camera.js";var O;!function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"}(O||(O={}));const Q=30,X=[1,3e8],Y=70;function Z(t,e,n){return n[0]=e[0]/(t.fullWidth/t.pixelRatio),n[1]=e[1]/(t.fullHeight/t.pixelRatio),n}function $(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function _(t,e,n){const o=s(B.get(),n[3],S(n));a(o)||c(o,u)||(M(Qt,t.eye,e),y(Qt,Qt,o),t.eye=g(Qt,Qt,e),M(Qt,t.center,e),y(Qt,Qt,o),t.center=g(Qt,Qt,e),t.up=y(Qt,t.up,o))}function tt(t,e,n,o){return q(t,J(e,n,_t),o)}function et(t,e,n,o){return q(t,K(e,n,_t),o)}function nt(t,e,n,o){const r=D.get();let a=1-n;M(r,e,t.eye);const i=d(r);let s=i*(1-a);a>=0&&s<o&&(s=o,a=-(s-i)/i),Math.abs(i-s)<1e-6||(b(r,r,a),t.eye=g(Qt,t.eye,r),t.center=j(Qt,t.center,e,a))}function ot(t,e,n){e.getScreenCenter(rt),L(t,e,rt,Qt)&&(e.center=Qt);const o=e.distance,r=o*n;if(Math.abs(o-r)<1e-6)return;const a=b(D.get(),e.viewForward,r);e.eye=M(Qt,e.center,a)}const rt=i();function at(t,e){v(e,0,0,0);for(const n of t)g(e,e,n);b(e,e,1/t.length)}function it(t,e,n,o){return Math.sin(t/d(e))*(n+o.radius)}function st(t,e,n,o){return it(Math.PI/2,e,n,o)+(t-Math.PI/2)}var ct;!function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"}(ct||(ct={}));const mt={Elevation:3e4,Angle:e(6)},lt={Pole:.95,Angle:e(18),Tilt:45},ut=e(80);function pt(t,e,n,o,r,a){const i=w(),s=T();let c=!0,m=!0;return t.intersectScreen(n,i,a)?s[3]=d(i):(m=!1,e.aboveGround&&r!==O.Ellipsoid?s[3]=Math.max(d(e.center),.9*o.radius):s[3]=d(e.eye)-e.relativeElevation,r===O.Silhouette?yt(s,e,n,i):c=L(s,e,n,i)),{sphere:s,scenePickPoint:c?i:null,hasGeometryIntersection:m}}function ft(t,e,n,o){if(d(t.eye)-o.radius>mt.Elevation)return ct.Horizontal;if(!n)return ct.Vertical;K(t,e,te);return-Math.sign(t.relativeElevation)*(.5*Math.PI+W(t.eye,te.direction))<mt.Angle?ct.Vertical:ct.Horizontal}function ht(t,e,n){M(Mt,n,e),t.eye=M(Qt,t.eye,Mt),t.center=M(Qt,t.center,Mt)}const Mt=w();function yt(t,e,n,o){const r=K(e,n,_t);return!a(r)&&(F(t,r,gt),R(t,r,o)?!(P(gt,r.origin)<P(o,r.origin))||(I(o,gt),!1):(M(dt,e.eye,e.center),z(dt,dt),C(dt,-x(z(dt,dt),gt),bt),q(bt,r,o),!1))}const gt=w(),dt=w(),bt=V();function jt(a,i,s,c,m,l){let u=0;if(k(Zt,a,i),M(Xt,a,i),d(a)<=m||!c.aboveGround){k(s,Xt,c.eye);const p=x(a,i)/(d(a)*d(i));if(p<.9999)u=o(p);else{const t=d(k(w(),a,i))/(d(a)*d(i));u=r(t)}const f=Math.cos(n(t.normalize(e(l)),0,ut));u=-u-Math.max(0,d(i)-m)/(f*m)}else M(vt,c.eye,c.center),k(s,Xt,vt),u=-d(Xt)/m;return z(s,s),b(s,s,d(Zt)),u}const vt=w();function zt(r,a,i,s){let c,m;const l=Math.cos(n(t.normalize(e(s)),0,ut));return c=a>i?-(a-i)/(l*i):a<-i?Math.PI-(a+i)/(l*i):o(a/i),m=r>i?-(r-i)/(l*i):r<-i?Math.PI-(r+i)/(l*i):o(r/i),(m-c)*i}function xt(t,e,n,o,r,a,i,s,c,m){const l=zt(t[2],e[2],a[3],s),u=c?zt(t[0],e[0],a[3],180):e[0]-t[0],p=Math.sin(i)*u-Math.cos(i)*l,h=Math.cos(i)*u+Math.sin(i)*l;z(Qt,r);const M=c?p/Math.sqrt(Math.abs(a[3]**2-x(n,Qt)**2)):p/a[3],y=h/Math.sqrt(Math.abs(a[3]**2-x(n,o)**2));f(m,M,y)}function Pt(t,e,n,o,r,a,i,s,c,m){k(Zt,t,e),G(a.up,a.eye,Ft,Rt,Tt),G([0,0,1],a.eye,Vt,qt,Ct),I(n,qt),I(o,Vt),z(n,n),b(n,n,d(Zt)),U(t,z(Rt,Rt),z(Tt,Tt),z(Ft,Ft),Wt),U(e,Rt,Tt,Ft,Bt),xt(Wt,Bt,t,Vt,qt,i,s,c,m,r)}function It(t,e,n,o,r,a,i){s(Kt,r,o),s(Lt,i,a),m(Nt,Kt,Lt),M(e,t,n),y(e,e,Nt),g(e,e,n)}function kt(t,e,n,o,r,a){s(Kt,o,n),s(Lt,a,r),m(Nt,Kt,Lt),M(Qt,t.eye,e),y(Qt,Qt,Nt),t.eye=g(Qt,Qt,e),M(Qt,t.center,e),y(Qt,Qt,Nt),t.center=g(Qt,Qt,e),M(Qt,t.up,e),y(Qt,Qt,Nt),t.up=g(Qt,Qt,e)}function wt(t,e,n,o,r,a){return(Math.abs(o)>Math.PI-lt.Angle||Math.abs(o)<lt.Angle)&&(Math.abs(t[2])<n*lt.Pole||Math.abs(e)>n)&&a.aboveGround&&r<lt.Tilt}function Et(t,e,n,o,r,a){if(a)A(n,o,Jt),_(e,t,Jt);else{const a=jt(n,o,$t,e,t[3],r);_(e,t,H($t,a))}}function St(t,e,n,o,r,a,i){const s=i?20:1,c=1e-12;let m,l;I(Ot,o),Yt.copyFrom(e);for(let u=0;u<s&&P(n,Ot)>c&&(m=P(n,Ot),Pt(n,Ot,qt,Vt,Dt,Yt,t,r,a,i),kt(Yt,t,Vt,Dt[1],qt,Dt[0]),It(Ot,Ot,t,Vt,Dt[1],qt,Dt[0]),l=P(n,Ot),l<m||0===u);u++)e.copyFrom(Yt)}function At(n,o,r,a,i,s,c){wt(r,x(o.up,r),n[3],-t.normalize(e(i)),s,o)?St(n,o,r,a,-t.normalize(e(i)),s,c):Et(n,o,r,a,s,c)}function Ht(t,e,n,o,r,a){const{eye:i}=t;G([0,0,1],i,Vt,qt,Ct);const s=e.translation[0]*n.pan,c="zoom"===r.mode?0:e.translation[1]*n.pan,m=Math.max(Math.sqrt(Math.abs(1-x(t.center,Vt)**2/d(t.center)**2)),.5),u=(Math.sin(a)*c+Math.cos(a)*s)/m,p=-Math.cos(a)*c+Math.sin(a)*s;switch(l(o.pan.matrix,o.pan.matrix,u,Vt),o.pan.enabled=!0,r.mode){case"pan":l(o.pan.matrix,o.pan.matrix,p,qt),o.pan.enabled=!0;break;case"zoom":o.zoom=-e.translation[1]*n.zoom}}function Gt(t,e,n,o,r){const{eye:a,viewRight:i}=t,s=k(D.get(),i,a),c=e.translation[0]*n.pan;switch(0!==c&&(l(o.pan.matrix,o.pan.matrix,-c,s),o.pan.enabled=!0),r.mode){case"pan":{const t=e.translation[1]*n.pan;0!==t&&(l(o.pan.matrix,o.pan.matrix,t,i),o.pan.enabled=!0);break}case"zoom":o.zoom=-e.translation[1]*n.zoom}}function Ut(n,o,r,a,i,s,c,m,l){wt(n.center,x(n.up,n.center),d(n.center),-t.normalize(e(s)),c,o)?Ht(o,r,a,m,l,-t.normalize(e(i))):Gt(o,r,a,m,l)}const Vt=w(),qt=w(),Ct=w(),Ft=w(),Rt=w(),Tt=w(),Wt=w(),Bt=w(),Dt=h(),Jt=E(),Kt=p(),Lt=p(),Nt=p(),Ot=w(),Qt=w(),Xt=w(),Yt=new N,Zt=w(),$t=w(),_t={origin:w(),direction:w()},te={origin:w(),direction:w()};export{X as DISTANCE_CLAMP_VALUES,ct as NavigationMode,Q as PIVOT_DISTANCE_MODIFIER,lt as PreservingHeadingThreshold,Y as SCREEN_PIXEL_AREA,O as SpherePickPointFallback,ut as TiltThresholdPanningSpeed,mt as VerticalPanTresholds,ht as applyPanPlanar,Et as applyPanSphericalDirectRotation,St as applyPanSphericalPreserveHeading,_ as applyRotation,kt as applyRotationWithTwoAxes,ot as applyZoomOnSphere,nt as applyZoomToPoint,at as centroid,ft as decideNavigationMode,tt as intersectPlaneFromScreenPoint,et as intersectPlaneFromScreenPointAtEye,zt as lengthFromPoints,Z as normalizeCoordinate,$ as normalizeRotationDelta,st as offSurfaceTiltToEyeTiltGlobal,it as onSurfaceTiltToEyeTiltGlobal,Ut as panMotionToRotationMatrix,At as panToPosition,pt as pickPointAndInitSphere,wt as preserveHeadingThreshold,It as rotatePointAroundTwoAxes,jt as rotationAngleAndAxisDirectRotation,Pt as rotationAnglesAndAxesHeadingPreserving,xt as rotationAnglesHeadingPreserving,yt as sphereOrPlanePointFromScreenPoint};
