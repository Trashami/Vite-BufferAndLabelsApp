/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{projectBuffer as o}from"../../../../geometry/projection.js";import{pathsToTriangulationInfo as t,CounterClockwiseMode as n}from"../../../../geometry/support/triangulationUtils.js";import{applyPerVertexElevationAlignment as i}from"../../layers/graphics/elevationAlignmentUtils.js";import{DRAPED_Z as s}from"../../terrain/OverlayRenderer.js";function e(o,s,e,r){const c=t(o.rings,o.hasZ,n.CCW_IS_HOLE),u=new Float64Array(c.position.length),h=i(c.position,o.spatialReference,0,u,0,c.position,0,c.position.length/3,s,e,r),g=null!=h;return new l(c.position,u,a(c.polygons,c.position,u),p(c.outlines,c.position,u),g,h)}function r(i,e){const r=t(i.rings,!1,n.CCW_IS_HOLE),c=o(r.position,i.spatialReference,0,r.position,e,0,r.position.length/3);for(let o=2;o<r.position.length;o+=3)r.position[o]=s;return{position:r.position,polygons:a(r.polygons,r.position),outlines:p(r.outlines,r.position),projectionSuccess:c}}function p(o,t,n){return o.filter((({count:o})=>o>1)).map((({index:o,count:i})=>{const s=3*o,e=s+3*i;return n?new u(o,i,t.subarray(s,e),n.subarray(s,e)):new c(o,i,t.subarray(s,e))}))}function a(o,t,n){const i=new Array;for(const{index:s,count:e,holeIndices:r,pathLengths:p}of o){if(e<=1)continue;const o=3*s,a=o+3*e,c=r.map((o=>o-s));i.push({index:s,count:e,holeIndices:c,pathLengths:p,position:t.subarray(o,a),mapPosition:n?n.subarray(o,a):void 0})}return i}class c{constructor(o,t,n){this.index=o,this.count=t,this.position=n}}class u extends c{constructor(o,t,n,i){super(o,t,n),this.mapPosition=i}}class l{constructor(o,t,n,i,s,e){this.position=o,this.mapPosition=t,this.polygons=n,this.outlines=i,this.projectionSuccess=s,this.sampledElevation=e}}export{l as PolygonRenderInfo,e as geometryToRenderInfo,r as geometryToRenderInfoDraped};
