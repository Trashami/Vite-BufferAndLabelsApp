/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{isNone as t,isSome as e,unwrapOr as r}from"../../../../core/maybe.js";import{slice as o}from"../../../../core/typedArrayUtil.js";import{p as a}from"../../../../chunks/vec2.js";import{s as n}from"../../../../chunks/vec3.js";import{c as i}from"../../../../chunks/vec3f64.js";import{O as s}from"../../../../chunks/vec4f64.js";import{lonLatToWebMercatorComparable as u}from"../../../../geometry/projection.js";import{getReferenceEllipsoid as c}from"../../../../geometry/projectionEllipsoid.js";import{ViewingMode as l}from"../../../ViewingMode.js";import{PrimitiveType as p}from"../../webgl-engine/lib/basicInterfaces.js";import{Geometry as f}from"../../webgl-engine/lib/Geometry.js";import{VertexAttribute as h}from"../../webgl-engine/lib/VertexAttribute.js";function m(t,e=null){const r=[],o=[];E(t,o,r);const a=o[0][1].data,n=r[0][1].length,i=new Array(n).fill(0);return T(t,o,r),A(t,o,r,i),I(t,o,r,i),O(t,o,r,i),b(t,o,r,i),R(t,o,r,i),g(t,o,r,i),y(t,o,r,a),new f(o,r,p.Line,e)}function E(t,e,r){const{attributeData:{position:a},removeDuplicateStartEnd:n}=t,i=d(a)&&n,s=a.length/3-(i?1:0),u=new Array(2*(s-1)),c=i?o(a,0,a.length-3):a;let l=0;for(let o=0;o<s-1;o++)u[l++]=o,u[l++]=o+1;e.push([h.POSITION,{size:3,data:c,exclusive:i}]),r.push([h.POSITION,u])}function T(e,r,o){const a=e.attributeData.mapPosition;t(a)||(o.push([h.MAPPOS,o[0][1]]),r.push([h.MAPPOS,{size:3,data:a}]))}function A(t,o,a,n){if(e(t.attributeData.colorFeature))return;const i=t.attributeData.color;o.push([h.COLOR,{size:4,data:r(i,s)}]),a.push([h.COLOR,n])}function O(t,r,o,a){if(!e(t.attributeData.normal))return;const n=t.attributeData.normal;r.push([h.NORMAL,{size:3,data:n}]),o.push([h.NORMAL,a])}function b(e,r,o,a){const n=e.attributeData.colorFeature;t(n)||(r.push([h.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),o.push([h.COLOR,a]))}function I(t,o,a,n){if(e(t.attributeData.sizeFeature))return;const i=t.attributeData.size;o.push([h.SIZE,{size:1,data:[r(i,1)]}]),a.push([h.SIZE,n])}function R(e,r,o,a){const n=e.attributeData.sizeFeature;t(n)||(r.push([h.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),o.push([h.SIZEFEATUREATTRIBUTE,a]))}function g(e,r,o,a){const n=e.attributeData.opacityFeature;t(n)||(r.push([h.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),o.push([h.OPACITYFEATUREATTRIBUTE,a]))}function y(e,r,o,i){if(t(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==l.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(i.length),p=c(e.overlayInfo.spatialReference);for(let t=0;t<s.length;t+=3)u(i,t,s,t,p);const f=i.length/3,m=new Float32Array(f+1);let E=F,T=j,A=0,O=0;n(E,s[O++],s[O++],s[O++]),m[0]=0;for(let t=1;t<f+1;++t)t===f&&(O=0),n(T,s[O++],s[O++],s[O++]),A+=a(E,T),m[t]=A,[E,T]=[T,E];r.push([h.DISTANCETOSTART,{size:1,data:m}]),o.push([h.DISTANCETOSTART,o[0][1]])}function d(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}var D;!function(t){t[t.KEEP=0]="KEEP",t[t.REMOVE=1]="REMOVE"}(D||(D={}));const F=i(),j=i();function w(e,r){if(t(e)||0===e.length)return[];const o=[];return e.forEach((t=>{const e=t.length,a=new Float64Array(3*e);t.forEach(((t,e)=>{a[3*e+0]=t[0],a[3*e+1]=t[1],a[3*e+2]=t[2]}));const n={attributeData:{position:a,normal:r},removeDuplicateStartEnd:!1};o.push(n)})),o}export{D as RemoveDuplicateStartEnd,m as createGeometry,w as lineStripsToParameters};
