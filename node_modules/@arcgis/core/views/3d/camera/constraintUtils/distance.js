/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{isSome as e}from"../../../../core/maybe.js";import{c as r,b as n,a as t,i as o,r as i}from"../../../../chunks/vec3.js";import{c as s}from"../../../../chunks/vec3f64.js";import{wrap as c}from"../../../../geometry/support/ray.js";import{i as a,k as f}from"../../../../chunks/sphere.js";import{defaultConstraintOptions as m,interactionDirectionTowardsConstraintMinimization as u,adjustRangeForInteraction as p}from"./common.js";import{InteractionType as y}from"./InteractionType.js";function d(e,r,n=m){if(!e.state.isLocal)return 0;const t=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||t===1/0)return 0;I.min=0,I.max=t,j(e,n,I);const o=g(e,r),i=I.max-o;return i>=-1e-6?0:i}function O(o,i,s=m){const p=d(o,i,s);if(0===p)return!1;const y=o.pointsOfInterest.surfaceOrigin,O=g(o,i)+p,j=r(l,i.eye),I=u(i,s.interactionDirection,x(o,i,k),h);if(!a(f(y.renderLocation,O),c(i.eye,I),C))return!1;i.eye=C;const N=n(L,i.eye,j);i.center=t(C,i.center,N);const b=o.renderCoordsHelper.getAltitude(i.center),v=o.renderCoordsHelper.intersectInfiniteManifold(i.ray,b,C);return e(v)&&(i.center=v),!0}function j(e,r,n){const t=r.interactionType;if(t===y.NONE)return;const{min:o,max:i}=n,{interactionStartCamera:s,interactionFactor:c}=r,a=t===y.ZOOM||t===y.PAN,f=d(e,s),m=0===f?0:g(e,s);n.min=o,n.max=i;p(f,m,a,c,.05*m,n)}function g(e,r){const n=e.pointsOfInterest.surfaceOrigin;return o(r.eye,n.renderLocation)}function x(e,r,n){const t=e.pointsOfInterest.surfaceOrigin;return i(n,r.eye,t.renderLocation)}const I={min:0,max:0},l=s(),L=s(),h=s(),k=s(),C=s();export{O as applyDistanceConstraint,d as getDistanceConstraintError};
