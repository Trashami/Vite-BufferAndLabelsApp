/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import{isSome as s}from"../../core/maybe.js";import{getSumOfAttributesExpr as r,verifyBasicFieldValidity as t}from"./support/utils.js";import{verifyBinningParams as i}from"../support/binningUtils.js";import{getFieldsList as a}from"../support/utils.js";import{LayerType as o,binningCapableLayerTypes as n,createLayerAdapter as u,getLayerTypeLabels as l}from"../support/adapters/support/layerUtils.js";async function p(r){if(!(r&&r.layer&&r.attributes))throw new e("summary-statistics-for-attributes:missing-parameters","'layer' and 'attributes' parameters are required");if(r.attributes.some((e=>!!e.valueExpression))&&!r.view)throw new e("summary-statistics-for-attributes:missing-parameters","View is required when 'valueExpression' is specified in attributes");r.forBinning&&i(r,"summary-statistics-for-attributes");const{layer:p,...m}=r,c=[o.CSVLayer,o.FeatureLayer,o.OGCFeatureLayer,o.GeoJSONLayer,o.WFSLayer],f=r.forBinning?n:c,y=u(p,f,r.forBinning),d={layerAdapter:y,...m};if(d.includeZeros=null==d.includeZeros||d.includeZeros,d.includeNegatives=null==d.includeNegatives||d.includeNegatives,!y)throw new e("summary-statistics-for-attributes:invalid-parameters","'layer' must be one of these types: "+l(f).join(", "));const w=d.view,v=s(d.signal)?{signal:d.signal}:null;await Promise.all([w&&w.when(),y.load(v)]);const g=[];for(const e of d.attributes){const s=await a({field:e.field,valueExpression:e.valueExpression});Array.prototype.push.apply(g,s)}const b=t(y,g,"summary-statistics-for-attributes:invalid-parameters");if(b)throw b;return d}async function m(e){const{layerAdapter:s,...t}=await p(e),i=r(t.attributes,t.includeZeros,t.includeNegatives);return s.summaryStatistics({valueExpression:i.valueExpression,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,view:t.view,signal:t.signal})}export{m as default};
