/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import e from"../../../core/Error.js";import{isNone as r,isSome as a}from"../../../core/maybe.js";import{formatNumber as s}from"../../../intl/number.js";import{createClassBreaksRenderer as t,getField as n}from"../../../renderers/support/rasterRendererHelper.js";import{processRasterRendererParameters as o}from"../support/utils.js";async function i(s){const t=(s=await o(s)).layer,{rasterInfo:i}=t;if(i.bandCount>1)throw new e("raster-class-breaks-renderer:not-supported","Multiband raster is not supported");const{attributeTable:l}=i;s.field||(s.field=a(l)?n(l,"value").name:"value");if(!(a(l)&&l.fields.find((e=>e.name.toLowerCase()===s.field.toLowerCase())))&&!a(i.histograms)&&(await t.updateRasterInfoWithEstimatedStats({renderingRule:s.renderingRule,signal:s.signal}),r(i.histograms)))throw new e("raster-class-breaks-renderer:not-supported","Histograms or raster attribute table is required on the source raster. Unable to estimate histograms");const{colors:u,numClasses:m}=s;if(u&&m&&u.length!==m)throw new e("raster-class-breaks-renderer:not-supported","The size of the `colors` parameter does not match 'numClasses'");return s.classificationMethod||(s.classificationMethod="natural-breaks"),s}async function l(a){a=await i(a);const s=t(a.layer.rasterInfo,a);if(r(s))throw new e("raster-class-breaks-renderer:not-supported","Class breaks renderer is not supported on this data");const n={minValue:s.minValue,maxValue:s.classBreakInfos[s.classBreakInfos.length-1].maxValue,normalizationTotal:null,classBreakInfos:s.classBreakInfos.map((e=>{const r=u(e.minValue,e.maxValue);return e.label=r,{minValue:e.minValue,maxValue:e.maxValue,label:r}}))};return{renderer:s,classBreaksResult:n}}function u(e,r){return s(e,{maximumFractionDigits:3})+" - "+s(r,{maximumFractionDigits:3})}export{l as createRenderer};
