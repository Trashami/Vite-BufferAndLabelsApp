/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
import{isNone as e,isSome as r}from"../../core/maybe.js";import{urlToObject as t,removeTrailingSlash as n,removeQueryParameters as s,join as l,Url as u,makeAbsolute as i}from"../../core/urlUtils.js";import{w as o}from"../../chunks/persistableUrlUtils.js";const c={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},a=Object.values(c),f=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),v=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),p=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function d(e){return!!f.test(e)}function m(r){if(e(r))return null;const n=t(r),s=n.path.match(f)||n.path.match(v);if(!s)return null;const[,l,u,i,o]=s,a=u.indexOf("/");return{title:h(-1!==a?u.slice(a+1):u),serverType:c[i.toLowerCase()],sublayer:null!=o&&""!==o?parseInt(o,10):null,url:{path:l}}}function w(e){const r=t(e).path.match(p);return r?{serviceUrl:r[1],sublayerId:Number(r[2])}:null}function h(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function y(e,t){const n=[];if(e){const t=m(e);r(t)&&t.title&&n.push(t.title)}if(t){const e=h(t);n.push(e)}if(2===n.length){if(n[0].toLowerCase().includes(n[1].toLowerCase()))return n[0];if(n[1].toLowerCase().includes(n[0].toLowerCase()))return n[1]}return n.join(" - ")}function g(e){if(!e)return!1;const r=".arcgis.com/",t="//services",n="//tiles",s="//features",l=(e=e.toLowerCase()).includes(r),u=e.includes(t)||e.includes(n)||e.includes(s);return l&&u}function C(e,r){return null!=r&&null!=e&&e.toLowerCase().includes(r.toLowerCase())}function S(e,r){return e?n(s(e,r)):e}function L(e){let{url:l}=e;if(!l)return{url:l};l=s(l,e.logger);const u=t(l),i=m(u.path);let o;if(r(i))null!=i.sublayer&&null==e.layer.layerId&&(o=i.sublayer),l=i.url.path;else if(e.nonStandardUrlAllowed){const e=w(u.path);r(e)&&(l=e.serviceUrl,o=e.sublayerId)}return{url:n(l),layerId:o}}function b(e,r,t,n,s){o(r,n,"url",s),n.url&&null!=e.layerId&&(n.url=l(n.url,t,e.layerId.toString()))}function I(e){if(!e)return!1;const r=e.toLowerCase(),t=r.includes("/services/"),n=r.includes("/mapserver/wmsserver"),s=r.includes("/imageserver/wmsserver"),l=r.includes("/wmsserver");return t&&(n||s||l)}function j(e){if(!e)return!1;const r=new u(i(e)).authority?.toLowerCase();return"server.arcgisonline.com"===r||"services.arcgisonline.com"===r}function U(e){if(!e)return!1;const r=new u(i(e)).authority?.toLowerCase();return null!=r&&r.includes("arcgis.com")}export{h as cleanTitle,U as isAGOLUrl,d as isArcGISUrl,g as isHostedAgolService,C as isHostedSecuredProxyService,j as isServerOrServicesAGOLUrl,I as isWmsServer,m as parse,w as parseNonStandardSublayerUrl,S as sanitizeUrl,L as sanitizeUrlWithLayerId,a as serverTypes,y as titleFromUrlAndName,b as writeUrlWithLayerId};
